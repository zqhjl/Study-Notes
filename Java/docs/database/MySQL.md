## MySQL åŸºç¡€
{: id="20210330211653-01q0sv6"}

### å…³ç³»å‹æ•°æ®åº“ä»‹ç»
{: id="20210330211653-c4x8unv"}

é¡¾åæ€ä¹‰ï¼Œå…³ç³»å‹æ•°æ®åº“å°±æ˜¯ä¸€ç§å»ºç«‹åœ¨å…³ç³»æ¨¡å‹çš„åŸºç¡€ä¸Šçš„æ•°æ®åº“ã€‚å…³ç³»æ¨¡å‹è¡¨æ˜äº†æ•°æ®åº“ä¸­æ‰€å­˜å‚¨çš„æ•°æ®ä¹‹é—´çš„è”ç³»ï¼ˆä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šï¼‰ã€‚
{: id="20210330211653-gscm497"}

å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬çš„æ•°æ®éƒ½è¢«å­˜æ”¾åœ¨äº†å„ç§è¡¨ä¸­ï¼ˆæ¯”å¦‚ç”¨æˆ·è¡¨ï¼‰ï¼Œè¡¨ä¸­çš„æ¯ä¸€åˆ—å°±å­˜æ”¾ç€ä¸€æ¡æ•°æ®ï¼ˆæ¯”å¦‚ä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼‰ã€‚
{: id="20210330211653-kdo8160"}

![](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/java-guide-blog/5e3c1a71724a38245aa43b02_99bf70d46cc247be878de9d3a88f0c44.png)
{: id="20210330211653-brvi46h"}

å¤§éƒ¨åˆ†å…³ç³»å‹æ•°æ®åº“éƒ½ä½¿ç”¨ SQL æ¥æ“ä½œæ•°æ®åº“ä¸­çš„æ•°æ®ã€‚å¹¶ä¸”ï¼Œå¤§éƒ¨åˆ†å…³ç³»å‹æ•°æ®åº“éƒ½æ”¯æŒäº‹åŠ¡çš„å››å¤§ç‰¹æ€§(ACID)ã€‚
{: id="20210330211653-9orulyg"}

**æœ‰å“ªäº›å¸¸è§çš„å…³ç³»å‹æ•°æ®åº“å‘¢ï¼Ÿ**
{: id="20210330211653-alkk72o"}

MySQLã€PostgreSQLã€Oracleã€SQL Serverã€SQLiteï¼ˆå¾®ä¿¡æœ¬åœ°çš„èŠå¤©è®°å½•çš„å­˜å‚¨å°±æ˜¯ç”¨çš„ SQLiteï¼‰ ......ã€‚
{: id="20210330211653-vqt0n88"}

### MySQL ä»‹ç»
{: id="20210330211653-9qcegtt"}

![](https://img-blog.csdnimg.cn/20210327143351823.png)
{: id="20210330211653-fqa3v0e"}

**MySQL æ˜¯ä¸€ç§å…³ç³»å‹æ•°æ®åº“ï¼Œä¸»è¦ç”¨äºæŒä¹…åŒ–å­˜å‚¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­çš„ä¸€äº›æ•°æ®æ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ã€‚**
{: id="20210330211653-z7iv187"}

ç”±äº MySQL æ˜¯å¼€æºå…è´¹å¹¶ä¸”æ¯”è¾ƒæˆç†Ÿçš„æ•°æ®åº“ï¼Œå› æ­¤ï¼ŒMySQL è¢«å¤§é‡ä½¿ç”¨åœ¨å„ç§ç³»ç»Ÿä¸­ã€‚ä»»ä½•äººéƒ½å¯ä»¥åœ¨ GPL(General Public License) çš„è®¸å¯ä¸‹ä¸‹è½½å¹¶æ ¹æ®ä¸ªæ€§åŒ–çš„éœ€è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚MySQL çš„é»˜è®¤ç«¯å£å·æ˜¯**3306**ã€‚
{: id="20210330211653-fbb83nk"}

## å­˜å‚¨å¼•æ“
{: id="20210330211653-ueprh52"}

### å­˜å‚¨å¼•æ“ç›¸å…³çš„å‘½ä»¤
{: id="20210330211653-yg9m9gx"}

**æŸ¥çœ‹ MySQL æä¾›çš„æ‰€æœ‰å­˜å‚¨å¼•æ“**
{: id="20210330211653-iwce083"}

```sql
mysql> show engines;
```
{: id="20210330211653-q6qggpc"}

![æŸ¥çœ‹MySQLæä¾›çš„æ‰€æœ‰å­˜å‚¨å¼•æ“](https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/mysql-engines.png)
{: id="20210330211653-qkjj5kw"}

ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å‡º MySQL å½“å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDB,å¹¶ä¸”åœ¨ 5.7 ç‰ˆæœ¬æ‰€æœ‰çš„å­˜å‚¨å¼•æ“ä¸­åªæœ‰ InnoDB æ˜¯äº‹åŠ¡æ€§å­˜å‚¨å¼•æ“ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ InnoDB æ”¯æŒäº‹åŠ¡ã€‚
{: id="20210330211653-euvxd9z"}

**æŸ¥çœ‹ MySQL å½“å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“**
{: id="20210330211653-y16yqqr"}

æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹é»˜è®¤çš„å­˜å‚¨å¼•æ“ã€‚
{: id="20210330211653-runfqlg"}

```sql
mysql> show variables like '%storage_engine%';
```
{: id="20210330211653-ft7wjvy"}

**æŸ¥çœ‹è¡¨çš„å­˜å‚¨å¼•æ“**
{: id="20210330211653-yz8n7v4"}

```sql
show table status like "table_name" ;
```
{: id="20210330211653-ghkaart"}

![æŸ¥çœ‹è¡¨çš„å­˜å‚¨å¼•æ“](https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/æŸ¥çœ‹è¡¨çš„å­˜å‚¨å¼•æ“.png)
{: id="20210330211653-sdhxa1s"}

### MyISAM å’Œ InnoDB çš„åŒºåˆ«
{: id="20210330211653-q3tavmd"}

![](https://img-blog.csdnimg.cn/20210327145248960.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0MzM3Mjcy,size_16,color_FFFFFF,t_70)
{: id="20210330211653-lnl8mzu"}

MySQL 5.5 ä¹‹å‰ï¼ŒMyISAM å¼•æ“æ˜¯ MySQL çš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œå¯è°“æ˜¯é£å…‰ä¸€æ—¶ã€‚
{: id="20210330211653-6lcbcxp"}

è™½ç„¶ï¼ŒMyISAM çš„æ€§èƒ½è¿˜è¡Œï¼Œå„ç§ç‰¹æ€§ä¹Ÿè¿˜ä¸é”™ï¼ˆæ¯”å¦‚å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°ç­‰ï¼‰ã€‚ä½†æ˜¯ï¼ŒMyISAM ä¸æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”ï¼Œè€Œä¸”æœ€å¤§çš„ç¼ºé™·å°±æ˜¯å´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ã€‚
{: id="20210330211653-fschxbx"}

5.5 ç‰ˆæœ¬ä¹‹åï¼ŒMySQL å¼•å…¥äº† InnoDBï¼ˆäº‹åŠ¡æ€§æ•°æ®åº“å¼•æ“ï¼‰ï¼ŒMySQL 5.5 ç‰ˆæœ¬åé»˜è®¤çš„å­˜å‚¨å¼•æ“ä¸º InnoDBã€‚å°ä¼™å­ï¼Œä¸€å®šè¦è®°å¥½è¿™ä¸ª InnoDB ï¼Œä½ æ¯æ¬¡ä½¿ç”¨ MySQL æ•°æ®åº“éƒ½æ˜¯ç”¨çš„è¿™ä¸ªå­˜å‚¨å¼•æ“å§ï¼Ÿ
{: id="20210330211653-ycu5i6p"}

è¨€å½’æ­£ä¼ ï¼å’±ä»¬ä¸‹é¢è¿˜æ˜¯æ¥ç®€å•å¯¹æ¯”ä¸€ä¸‹ä¸¤è€…ï¼š
{: id="20210330211653-7mvm85f"}

**1.æ˜¯å¦æ”¯æŒè¡Œçº§é”**
{: id="20210330211653-ifvvxmu"}

MyISAM åªæœ‰è¡¨çº§é”(table-level locking)ï¼Œè€Œ InnoDB æ”¯æŒè¡Œçº§é”(row-level locking)å’Œè¡¨çº§é”,é»˜è®¤ä¸ºè¡Œçº§é”ã€‚
{: id="20210330211653-x4epk03"}

ä¹Ÿå°±è¯´ï¼ŒMyISAM ä¸€é”å°±æ˜¯é”ä½äº†æ•´å¼ è¡¨ï¼Œè¿™åœ¨å¹¶å‘å†™çš„æƒ…å†µä¸‹æ˜¯å¤šä¹ˆæ»´æ†¨æ†¨å•Šï¼è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ InnoDB åœ¨å¹¶å‘å†™çš„æ—¶å€™ï¼Œæ€§èƒ½æ›´ç‰›çš®äº†ï¼
{: id="20210330211653-ao0itq2"}

**2.æ˜¯å¦æ”¯æŒäº‹åŠ¡**
{: id="20210330211653-u0y3nil"}

MyISAM ä¸æä¾›äº‹åŠ¡æ”¯æŒã€‚
{: id="20210330211653-divi67n"}

InnoDB æä¾›äº‹åŠ¡æ”¯æŒï¼Œå…·æœ‰æäº¤(commit)å’Œå›æ»š(rollback)äº‹åŠ¡çš„èƒ½åŠ›ã€‚
{: id="20210330211653-jr11ras"}

**3.æ˜¯å¦æ”¯æŒå¤–é”®**
{: id="20210330211653-0uuhc4m"}

MyISAM ä¸æ”¯æŒï¼Œè€Œ InnoDB æ”¯æŒã€‚
{: id="20210330211653-z6o3fpo"}

ğŸŒˆ æ‹“å±•ä¸€ä¸‹ï¼š
{: id="20210330211653-j5koogn"}

ä¸€èˆ¬æˆ‘ä»¬ä¹Ÿæ˜¯ä¸å»ºè®®åœ¨æ•°æ®åº“å±‚é¢ä½¿ç”¨å¤–é”®çš„ï¼Œåº”ç”¨å±‚é¢å¯ä»¥è§£å†³ã€‚ä¸è¿‡ï¼Œè¿™æ ·ä¼šå¯¹æ•°æ®çš„ä¸€è‡´æ€§é€ æˆå¨èƒã€‚å…·ä½“è¦ä¸è¦ä½¿ç”¨å¤–é”®è¿˜æ˜¯è¦æ ¹æ®ä½ çš„é¡¹ç›®æ¥å†³å®šã€‚
{: id="20210330211653-0v2giwz"}

**4.æ˜¯å¦æ”¯æŒæ•°æ®åº“å¼‚å¸¸å´©æºƒåçš„å®‰å…¨æ¢å¤**
{: id="20210330211653-sw0z5al"}

MyISAM ä¸æ”¯æŒï¼Œè€Œ InnoDB æ”¯æŒã€‚
{: id="20210330211653-er8z8i8"}

ä½¿ç”¨ InnoDB çš„æ•°æ®åº“åœ¨å¼‚å¸¸å´©æºƒåï¼Œæ•°æ®åº“é‡æ–°å¯åŠ¨çš„æ—¶å€™ä¼šä¿è¯æ•°æ®åº“æ¢å¤åˆ°å´©æºƒå‰çš„çŠ¶æ€ã€‚è¿™ä¸ªæ¢å¤çš„è¿‡ç¨‹ä¾èµ–äº `redo log` ã€‚
{: id="20210330211653-ube6qym"}

ğŸŒˆ æ‹“å±•ä¸€ä¸‹ï¼š
{: id="20210330211653-t62sul9"}

- {: id="20210330211653-h48f3z2"}MySQL InnoDB å¼•æ“ä½¿ç”¨ **redo log(é‡åšæ—¥å¿—)** ä¿è¯äº‹åŠ¡çš„**æŒä¹…æ€§**ï¼Œä½¿ç”¨ **undo log(å›æ»šæ—¥å¿—)** æ¥ä¿è¯äº‹åŠ¡çš„**åŸå­æ€§**ã€‚
  {: id="20210330211653-n5ocfvl"}
- {: id="20210330211653-8prqshi"}MySQL InnoDB å¼•æ“é€šè¿‡ **é”æœºåˆ¶**ã€**MVCC** ç­‰æ‰‹æ®µæ¥ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§ï¼ˆ é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ **`REPEATABLE-READ`** ï¼‰ã€‚
  {: id="20210330211653-q9js6oj"}
- {: id="20210330211653-t91e5sz"}ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€åŸå­æ€§ã€éš”ç¦»æ€§ä¹‹åï¼Œä¸€è‡´æ€§æ‰èƒ½å¾—åˆ°ä¿éšœã€‚
  {: id="20210330211653-bay6ci2"}
{: id="20210330211653-k6mnpm2"}

**5.æ˜¯å¦æ”¯æŒ MVCC**
{: id="20210330211653-760dehv"}

MyISAM ä¸æ”¯æŒï¼Œè€Œ InnoDB æ”¯æŒã€‚
{: id="20210330211653-jixtpeg"}

è®²çœŸï¼Œè¿™ä¸ªå¯¹æ¯”æœ‰ç‚¹åºŸè¯ï¼Œæ¯•ç«Ÿ MyISAM è¿è¡Œçº§é”éƒ½ä¸æ”¯æŒã€‚
{: id="20210330211653-duzqyhj"}

MVCC å¯ä»¥çœ‹ä½œæ˜¯è¡Œçº§é”çš„ä¸€ä¸ªå‡çº§ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘åŠ é”æ“ä½œï¼Œæä¾›æ€§èƒ½ã€‚
{: id="20210330211653-iapbbe3"}

### å…³äº MyISAM å’Œ InnoDB çš„é€‰æ‹©é—®é¢˜
{: id="20210330211653-psw71yu"}

å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯ InnoDB å­˜å‚¨å¼•æ“ï¼Œåœ¨æŸäº›è¯»å¯†é›†çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ MyISAM ä¹Ÿæ˜¯åˆé€‚çš„ã€‚ä¸è¿‡ï¼Œå‰ææ˜¯ä½ çš„é¡¹ç›®ä¸ä»‹æ„ MyISAM ä¸æ”¯æŒäº‹åŠ¡ã€å´©æºƒæ¢å¤ç­‰ç¼ºç‚¹ï¼ˆå¯æ˜¯~æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šä»‹æ„å•Šï¼ï¼‰ã€‚
{: id="20210330211653-zbl5hcf"}

ã€ŠMySQL é«˜æ€§èƒ½ã€‹ä¸Šé¢æœ‰ä¸€å¥è¯è¿™æ ·å†™åˆ°:
{: id="20210330211653-16z09f8"}

> ä¸è¦è½»æ˜“ç›¸ä¿¡â€œMyISAM æ¯” InnoDB å¿«â€ä¹‹ç±»çš„ç»éªŒä¹‹è°ˆï¼Œè¿™ä¸ªç»“è®ºå¾€å¾€ä¸æ˜¯ç»å¯¹çš„ã€‚åœ¨å¾ˆå¤šæˆ‘ä»¬å·²çŸ¥åœºæ™¯ä¸­ï¼ŒInnoDB çš„é€Ÿåº¦éƒ½å¯ä»¥è®© MyISAM æœ›å°˜è«åŠï¼Œå°¤å…¶æ˜¯ç”¨åˆ°äº†èšç°‡ç´¢å¼•ï¼Œæˆ–è€…éœ€è¦è®¿é—®çš„æ•°æ®éƒ½å¯ä»¥æ”¾å…¥å†…å­˜çš„åº”ç”¨ã€‚
> {: id="20210330211653-6uvd7h1"}
{: id="20210330211653-bf0ghhl"}

ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬é€‰æ‹© InnoDB éƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯æŸäº›æƒ…å†µä¸‹ä½ å¹¶ä¸åœ¨ä¹å¯æ‰©å±•èƒ½åŠ›å’Œå¹¶å‘èƒ½åŠ›ï¼Œä¹Ÿä¸éœ€è¦äº‹åŠ¡æ”¯æŒï¼Œä¹Ÿä¸åœ¨ä¹å´©æºƒåçš„å®‰å…¨æ¢å¤é—®é¢˜çš„è¯ï¼Œé€‰æ‹© MyISAM ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯éœ€è¦è€ƒè™‘åˆ°è¿™äº›é—®é¢˜çš„ã€‚
{: id="20210330211653-ev95ek2"}

å› æ­¤ï¼Œå¯¹äºå’±ä»¬æ—¥å¸¸å¼€å‘çš„ä¸šåŠ¡ç³»ç»Ÿæ¥è¯´ï¼Œä½ å‡ ä¹æ‰¾ä¸åˆ°ä»€ä¹ˆç†ç”±å†ä½¿ç”¨ MyISAM ä½œä¸ºè‡ªå·±çš„ MySQL æ•°æ®åº“çš„å­˜å‚¨å¼•æ“ã€‚
{: id="20210330211653-kjn10tw"}

## é”æœºåˆ¶ä¸ InnoDB é”ç®—æ³•
{: id="20210330211653-xyqf8is"}

**MyISAM å’Œ InnoDB å­˜å‚¨å¼•æ“ä½¿ç”¨çš„é”ï¼š**
{: id="20210330211653-d4hdfu0"}

- {: id="20210330211653-181vygg"}MyISAM é‡‡ç”¨è¡¨çº§é”(table-level locking)ã€‚
  {: id="20210330211653-kitg0t6"}
- {: id="20210330211653-kvqjxip"}InnoDB æ”¯æŒè¡Œçº§é”(row-level locking)å’Œè¡¨çº§é”,é»˜è®¤ä¸ºè¡Œçº§é”
  {: id="20210330211653-i5xwhcz"}
{: id="20210330211653-yx3yzq8"}

**è¡¨çº§é”å’Œè¡Œçº§é”å¯¹æ¯”ï¼š**
{: id="20210330211653-2xohhh2"}

- {: id="20210330211653-shums7s"}**è¡¨çº§é”ï¼š** MySQL ä¸­é”å®š **ç²’åº¦æœ€å¤§** çš„ä¸€ç§é”ï¼Œå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°‘ï¼ŒåŠ é”å¿«ï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚å…¶é”å®šç²’åº¦æœ€å¤§ï¼Œè§¦å‘é”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ï¼ŒMyISAM å’Œ InnoDB å¼•æ“éƒ½æ”¯æŒè¡¨çº§é”ã€‚
  {: id="20210330211653-lg2sfjb"}
- {: id="20210330211653-yd0yj5b"}**è¡Œçº§é”ï¼š** MySQL ä¸­é”å®š **ç²’åº¦æœ€å°** çš„ä¸€ç§é”ï¼Œåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè¿›è¡ŒåŠ é”ã€‚ è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œå¹¶å‘åº¦é«˜ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ï¼ŒåŠ é”æ…¢ï¼Œä¼šå‡ºç°æ­»é”ã€‚
  {: id="20210330211653-j79azvj"}
{: id="20210330211653-6xaoa2t"}

**InnoDB å­˜å‚¨å¼•æ“çš„é”çš„ç®—æ³•æœ‰ä¸‰ç§ï¼š**
{: id="20210330211653-lg00f9i"}

- {: id="20210330211653-hnu5pzr"}Record lockï¼šå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”
  {: id="20210330211653-ru7o19f"}
- {: id="20210330211653-y4o3zn0"}Gap lockï¼šé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«
  {: id="20210330211653-3qvbgl2"}
- {: id="20210330211653-dxk5n9c"}Next-key lockï¼šrecord+gap é”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…å«è®°å½•æœ¬èº«
  {: id="20210330211653-s57zdcc"}
{: id="20210330211653-tr9vf93"}

## æŸ¥è¯¢ç¼“å­˜
{: id="20210330211653-3hkostz"}

æ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ã€‚ä¸è¿‡ï¼ŒMySQL 8.0 ç‰ˆæœ¬åç§»é™¤ï¼Œå› ä¸ºè¿™ä¸ªåŠŸèƒ½ä¸å¤ªå®ç”¨
{: id="20210330211653-s7sj4r0"}

`my.cnf` åŠ å…¥ä»¥ä¸‹é…ç½®ï¼Œé‡å¯ MySQL å¼€å¯æŸ¥è¯¢ç¼“å­˜
{: id="20210330211653-g5dxeaa"}

```properties
query_cache_type=1
query_cache_size=600000
```
{: id="20210330211653-vmi5hz5"}

MySQL æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¹Ÿå¯ä»¥å¼€å¯æŸ¥è¯¢ç¼“å­˜
{: id="20210330211653-auq8msw"}

```properties
set global  query_cache_type=1;
set global  query_cache_size=600000;
```
{: id="20210330211653-5hkfg61"}

å¦‚ä¸Šï¼Œ**å¼€å¯æŸ¥è¯¢ç¼“å­˜ååœ¨åŒæ ·çš„æŸ¥è¯¢æ¡ä»¶ä»¥åŠæ•°æ®æƒ…å†µä¸‹ï¼Œä¼šç›´æ¥åœ¨ç¼“å­˜ä¸­è¿”å›ç»“æœ**ã€‚è¿™é‡Œçš„æŸ¥è¯¢æ¡ä»¶åŒ…æ‹¬æŸ¥è¯¢æœ¬èº«ã€å½“å‰è¦æŸ¥è¯¢çš„æ•°æ®åº“ã€å®¢æˆ·ç«¯åè®®ç‰ˆæœ¬å·ç­‰ä¸€äº›å¯èƒ½å½±å“ç»“æœçš„ä¿¡æ¯ã€‚å› æ­¤ä»»ä½•ä¸¤ä¸ªæŸ¥è¯¢åœ¨ä»»ä½•å­—ç¬¦ä¸Šçš„ä¸åŒéƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸å‘½ä¸­ã€‚æ­¤å¤–ï¼Œå¦‚æœæŸ¥è¯¢ä¸­åŒ…å«ä»»ä½•ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€å­˜å‚¨å‡½æ•°ã€ç”¨æˆ·å˜é‡ã€ä¸´æ—¶è¡¨ã€MySQL åº“ä¸­çš„ç³»ç»Ÿè¡¨ï¼Œå…¶æŸ¥è¯¢ç»“æœä¹Ÿä¸ä¼šè¢«ç¼“å­˜ã€‚
{: id="20210330211653-pip8jkc"}

ç¼“å­˜å»ºç«‹ä¹‹åï¼ŒMySQL çš„æŸ¥è¯¢ç¼“å­˜ç³»ç»Ÿä¼šè·Ÿè¸ªæŸ¥è¯¢ä¸­æ¶‰åŠçš„æ¯å¼ è¡¨ï¼Œå¦‚æœè¿™äº›è¡¨ï¼ˆæ•°æ®æˆ–ç»“æ„ï¼‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå’Œè¿™å¼ è¡¨ç›¸å…³çš„æ‰€æœ‰ç¼“å­˜æ•°æ®éƒ½å°†å¤±æ•ˆã€‚
{: id="20210330211653-6qkvl78"}

**ç¼“å­˜è™½ç„¶èƒ½å¤Ÿæå‡æ•°æ®åº“çš„æŸ¥è¯¢æ€§èƒ½ï¼Œä½†æ˜¯ç¼“å­˜åŒæ—¶ä¹Ÿå¸¦æ¥äº†é¢å¤–çš„å¼€é”€ï¼Œæ¯æ¬¡æŸ¥è¯¢åéƒ½è¦åšä¸€æ¬¡ç¼“å­˜æ“ä½œï¼Œå¤±æ•ˆåè¿˜è¦é”€æ¯ã€‚** å› æ­¤ï¼Œå¼€å¯æŸ¥è¯¢ç¼“å­˜è¦è°¨æ…ï¼Œå°¤å…¶å¯¹äºå†™å¯†é›†çš„åº”ç”¨æ¥è¯´æ›´æ˜¯å¦‚æ­¤ã€‚å¦‚æœå¼€å¯ï¼Œè¦æ³¨æ„åˆç†æ§åˆ¶ç¼“å­˜ç©ºé—´å¤§å°ï¼Œä¸€èˆ¬æ¥è¯´å…¶å¤§å°è®¾ç½®ä¸ºå‡ å MB æ¯”è¾ƒåˆé€‚ã€‚æ­¤å¤–ï¼Œ**è¿˜å¯ä»¥é€šè¿‡ sql_cache å’Œ sql_no_cache æ¥æ§åˆ¶æŸä¸ªæŸ¥è¯¢è¯­å¥æ˜¯å¦éœ€è¦ç¼“å­˜ï¼š**
{: id="20210330211653-jsbr84f"}

```sql
select sql_no_cache count(*) from usr;
```
{: id="20210330211653-e69xelv"}

## äº‹åŠ¡
{: id="20210330211653-d9s006e"}

### ä½•ä¸ºäº‹åŠ¡ï¼Ÿ
{: id="20210330211653-ak4zefp"}

ä¸€è¨€è”½ä¹‹ï¼Œ**äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚**
{: id="20210330211653-457c7hd"}

**å¯ä»¥ç®€å•ä¸¾ä¸€ä¸ªä¾‹å­ä¸ï¼Ÿ**
{: id="20210330211653-7qpt4oa"}

äº‹åŠ¡æœ€ç»å…¸ä¹Ÿç»å¸¸è¢«æ‹¿å‡ºæ¥è¯´ä¾‹å­å°±æ˜¯è½¬è´¦äº†ã€‚å‡å¦‚å°æ˜è¦ç»™å°çº¢è½¬è´¦ 1000 å…ƒï¼Œè¿™ä¸ªè½¬è´¦ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªå…³é”®æ“ä½œå°±æ˜¯ï¼š
{: id="20210330211653-ncjfqzq"}

1. {: id="20210330211653-wioknsa"}å°†å°æ˜çš„ä½™é¢å‡å°‘ 1000 å…ƒ
   {: id="20210330211653-w7t6b83"}
2. {: id="20210330211653-2mmcpng"}å°†å°çº¢çš„ä½™é¢å¢åŠ  1000 å…ƒã€‚
   {: id="20210330211653-cognif1"}
{: id="20210330211653-nxy7b1e"}

äº‹åŠ¡ä¼šæŠŠè¿™ä¸¤ä¸ªæ“ä½œå°±å¯ä»¥çœ‹æˆé€»è¾‘ä¸Šçš„ä¸€ä¸ªæ•´ä½“ï¼Œè¿™ä¸ªæ•´ä½“åŒ…å«çš„æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½è¦å¤±è´¥ã€‚
{: id="20210330211653-bg638yp"}

è¿™æ ·å°±ä¸ä¼šå‡ºç°å°æ˜ä½™é¢å‡å°‘è€Œå°çº¢çš„ä½™é¢å´å¹¶æ²¡æœ‰å¢åŠ çš„æƒ…å†µã€‚
{: id="20210330211653-hwcantr"}

### ä½•ä¸ºæ•°æ®åº“äº‹åŠ¡ï¼Ÿ
{: id="20210330211653-cgw9404"}

æ•°æ®åº“äº‹åŠ¡åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­æ¥è§¦çš„æœ€å¤šäº†ã€‚å¦‚æœä½ çš„é¡¹ç›®å±äºå•ä½“æ¶æ„çš„è¯ï¼Œä½ æ¥è§¦åˆ°çš„å¾€å¾€å°±æ˜¯æ•°æ®åº“äº‹åŠ¡äº†ã€‚
{: id="20210330211653-b6uuvgi"}

å¹³æ—¶ï¼Œæˆ‘ä»¬åœ¨è°ˆè®ºäº‹åŠ¡çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æŒ‡**åˆ†å¸ƒå¼äº‹åŠ¡**ï¼Œå¾€å¾€æŒ‡çš„å°±æ˜¯**æ•°æ®åº“äº‹åŠ¡**ã€‚
{: id="20210330211653-oyhw72i"}

**é‚£æ•°æ®åº“äº‹åŠ¡æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ**
{: id="20210330211653-foawjp0"}

ç®€å•æ¥è¯´ï¼šæ•°æ®åº“äº‹åŠ¡å¯ä»¥ä¿è¯å¤šä¸ªå¯¹æ•°æ®åº“çš„æ“ä½œï¼ˆä¹Ÿå°±æ˜¯ SQL è¯­å¥ï¼‰æ„æˆä¸€ä¸ªé€»è¾‘ä¸Šçš„æ•´ä½“ã€‚æ„æˆè¿™ä¸ªé€»è¾‘ä¸Šçš„æ•´ä½“çš„è¿™äº›æ•°æ®åº“æ“ä½œéµå¾ªï¼š**è¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸ,è¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ** ã€‚
{: id="20210330211653-tkv0dfy"}

```sql
# å¼€å¯ä¸€ä¸ªäº‹åŠ¡
START TRANSACTION;
# å¤šæ¡ SQL è¯­å¥
SQL1,SQL2...
## æäº¤äº‹åŠ¡
COMMIT;
```
{: id="20210330211653-zx0tzic"}

![](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/2020-12/640-20201207160554677.png)
{: id="20210330211653-82ppny6"}

å¦å¤–ï¼Œå…³ç³»å‹æ•°æ®åº“ï¼ˆä¾‹å¦‚ï¼š`MySQL`ã€`SQL Server`ã€`Oracle` ç­‰ï¼‰äº‹åŠ¡éƒ½æœ‰ **ACID** ç‰¹æ€§ï¼š
{: id="20210330211653-ea24mfa"}

![äº‹åŠ¡çš„ç‰¹æ€§](https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/%E4%BA%8B%E5%8A%A1%E7%89%B9%E6%80%A7.png)
{: id="20210330211653-2mje9q2"}

### ä½•ä¸º ACID ç‰¹æ€§å‘¢ï¼Ÿ
{: id="20210330211653-ec4rktp"}

1. {: id="20210330211653-4trei60"}**åŸå­æ€§**ï¼ˆ`Atomicity`ï¼‰ ï¼š äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼›
   {: id="20210330211653-8le4gqk"}
2. {: id="20210330211653-31j9jzv"}**ä¸€è‡´æ€§**ï¼ˆ`Consistency`ï¼‰ï¼š æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼Œä¾‹å¦‚è½¬è´¦ä¸šåŠ¡ä¸­ï¼Œæ— è®ºäº‹åŠ¡æ˜¯å¦æˆåŠŸï¼Œè½¬è´¦è€…å’Œæ”¶æ¬¾äººçš„æ€»é¢åº”è¯¥æ˜¯ä¸å˜çš„ï¼›
   {: id="20210330211653-y5z8wgv"}
3. {: id="20210330211653-fl2a0bm"}**éš”ç¦»æ€§**ï¼ˆ`Isolation`ï¼‰ï¼š å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼›
   {: id="20210330211653-dt6l6h3"}
4. {: id="20210330211653-bhalcac"}**æŒä¹…æ€§**ï¼ˆ`Durabilily`ï¼‰ï¼š ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚
   {: id="20210330211653-jjq1ke8"}
{: id="20210330211653-sm07k22"}

**æ•°æ®äº‹åŠ¡çš„å®ç°åŸç†å‘¢ï¼Ÿ**
{: id="20210330211653-rl6gaga"}

æˆ‘ä»¬è¿™é‡Œä»¥ MySQL çš„ InnoDB å¼•æ“ä¸ºä¾‹æ¥ç®€å•è¯´ä¸€ä¸‹ã€‚
{: id="20210330211653-2v760sj"}

MySQL InnoDB å¼•æ“ä½¿ç”¨ **redo log(é‡åšæ—¥å¿—)** ä¿è¯äº‹åŠ¡çš„**æŒä¹…æ€§**ï¼Œä½¿ç”¨ **undo log(å›æ»šæ—¥å¿—)** æ¥ä¿è¯äº‹åŠ¡çš„**åŸå­æ€§**ã€‚
{: id="20210330211653-revjyhv"}

MySQL InnoDB å¼•æ“é€šè¿‡ **é”æœºåˆ¶**ã€**MVCC** ç­‰æ‰‹æ®µæ¥ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§ï¼ˆ é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ **`REPEATABLE-READ`** ï¼‰ã€‚
{: id="20210330211653-rlsrh46"}

ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€åŸå­æ€§ã€éš”ç¦»æ€§ä¹‹åï¼Œä¸€è‡´æ€§æ‰èƒ½å¾—åˆ°ä¿éšœã€‚
{: id="20210330211653-egdec6a"}

### å¹¶å‘äº‹åŠ¡å¸¦æ¥å“ªäº›é—®é¢˜?
{: id="20210330211653-a9a6jxy"}

åœ¨å…¸å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘è¿è¡Œï¼Œç»å¸¸ä¼šæ“ä½œç›¸åŒçš„æ•°æ®æ¥å®Œæˆå„è‡ªçš„ä»»åŠ¡ï¼ˆå¤šä¸ªç”¨æˆ·å¯¹åŒä¸€æ•°æ®è¿›è¡Œæ“ä½œï¼‰ã€‚å¹¶å‘è™½ç„¶æ˜¯å¿…é¡»çš„ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹çš„é—®é¢˜ã€‚
{: id="20210330211653-zshf2ed"}

- {: id="20210330211653-zi6p3bw"}**è„è¯»ï¼ˆDirty readï¼‰:** å½“ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨è®¿é—®æ•°æ®å¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè€Œè¿™ç§ä¿®æ”¹è¿˜æ²¡æœ‰æäº¤åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ—¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¿™ä¸ªæ•°æ®ï¼Œç„¶åä½¿ç”¨äº†è¿™ä¸ªæ•°æ®ã€‚å› ä¸ºè¿™ä¸ªæ•°æ®æ˜¯è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°çš„è¿™ä¸ªæ•°æ®æ˜¯â€œè„æ•°æ®â€ï¼Œä¾æ®â€œè„æ•°æ®â€æ‰€åšçš„æ“ä½œå¯èƒ½æ˜¯ä¸æ­£ç¡®çš„ã€‚
  {: id="20210330211653-vnp370i"}
- {: id="20210330211653-jalz0d7"}**ä¸¢å¤±ä¿®æ”¹ï¼ˆLost to modifyï¼‰:** æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¯¥æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­ä¿®æ”¹äº†è¿™ä¸ªæ•°æ®åï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿä¿®æ”¹äº†è¿™ä¸ªæ•°æ®ã€‚è¿™æ ·ç¬¬ä¸€ä¸ªäº‹åŠ¡å†…çš„ä¿®æ”¹ç»“æœå°±è¢«ä¸¢å¤±ï¼Œå› æ­¤ç§°ä¸ºä¸¢å¤±ä¿®æ”¹ã€‚ ä¾‹å¦‚ï¼šäº‹åŠ¡ 1 è¯»å–æŸè¡¨ä¸­çš„æ•°æ® A=20ï¼Œäº‹åŠ¡ 2 ä¹Ÿè¯»å– A=20ï¼Œäº‹åŠ¡ 1 ä¿®æ”¹ A=A-1ï¼Œäº‹åŠ¡ 2 ä¹Ÿä¿®æ”¹ A=A-1ï¼Œæœ€ç»ˆç»“æœ A=19ï¼Œäº‹åŠ¡ 1 çš„ä¿®æ”¹è¢«ä¸¢å¤±ã€‚
  {: id="20210330211653-q38s19c"}
- {: id="20210330211653-53yfr8s"}**ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatablereadï¼‰:** æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚åœ¨è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ç»“æŸæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¯¥æ•°æ®ã€‚é‚£ä¹ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤æ¬¡è¯»æ•°æ®ä¹‹é—´ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹å¯¼è‡´ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–çš„æ•°æ®å¯èƒ½ä¸å¤ªä¸€æ ·ã€‚è¿™å°±å‘ç”Ÿäº†åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå› æ­¤ç§°ä¸ºä¸å¯é‡å¤è¯»ã€‚
  {: id="20210330211653-teffclq"}
- {: id="20210330211653-3bqgyj7"}**å¹»è¯»ï¼ˆPhantom readï¼‰:** å¹»è¯»ä¸ä¸å¯é‡å¤è¯»ç±»ä¼¼ã€‚å®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰è¯»å–äº†å‡ è¡Œæ•°æ®ï¼Œæ¥ç€å¦ä¸€ä¸ªå¹¶å‘äº‹åŠ¡ï¼ˆT2ï¼‰æ’å…¥äº†ä¸€äº›æ•°æ®æ—¶ã€‚åœ¨éšåçš„æŸ¥è¯¢ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰å°±ä¼šå‘ç°å¤šäº†ä¸€äº›åŸæœ¬ä¸å­˜åœ¨çš„è®°å½•ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œæ‰€ä»¥ç§°ä¸ºå¹»è¯»ã€‚
  {: id="20210330211653-cfjbe8f"}
{: id="20210330211653-wxq2dwi"}

**ä¸å¯é‡å¤è¯»å’Œå¹»è¯»åŒºåˆ«ï¼š**
{: id="20210330211653-7lp007n"}

ä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯ä¿®æ”¹æ¯”å¦‚å¤šæ¬¡è¯»å–ä¸€æ¡è®°å½•å‘ç°å…¶ä¸­æŸäº›åˆ—çš„å€¼è¢«ä¿®æ”¹ï¼Œå¹»è¯»çš„é‡ç‚¹åœ¨äºæ–°å¢æˆ–è€…åˆ é™¤æ¯”å¦‚å¤šæ¬¡è¯»å–ä¸€æ¡è®°å½•å‘ç°è®°å½•å¢å¤šæˆ–å‡å°‘äº†ã€‚
{: id="20210330211653-zf6b8bs"}

### äº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰å“ªäº›?
{: id="20210330211653-l190jde"}

SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼š
{: id="20210330211653-b8ma7k2"}

- {: id="20210330211653-40l9lp6"}**READ-UNCOMMITTED(è¯»å–æœªæäº¤)ï¼š** æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œ**å¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»**ã€‚
  {: id="20210330211653-xl40yuw"}
- {: id="20210330211653-juiq7es"}**READ-COMMITTED(è¯»å–å·²æäº¤)ï¼š** å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œ**å¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ**ã€‚
  {: id="20210330211653-wz8hgit"}
- {: id="20210330211653-zmeu0yt"}**REPEATABLE-READ(å¯é‡å¤è¯»)ï¼š** å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œ**å¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ**ã€‚
  {: id="20210330211653-dma82lv"}
- {: id="20210330211653-ag3dz6l"}**SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)ï¼š** æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**è¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»**ã€‚
  {: id="20210330211653-vc8uqtl"}
{: id="20210330211653-yydsm68"}

---
{: id="20210330211653-gkwsufx"}

|     éš”ç¦»çº§åˆ«     | è„è¯» | ä¸å¯é‡å¤è¯» | å¹»è¯» |
| :--------------: | :--: | :--------: | :--: |
| READ-UNCOMMITTED |  âˆš  |     âˆš     |  âˆš  |
|  READ-COMMITTED  |  Ã—  |     âˆš     |  âˆš  |
| REPEATABLE-READ |  Ã—  |     Ã—     |  âˆš  |
|   SERIALIZABLE   |  Ã—  |     Ã—     |  Ã—  |
{: id="20210330211653-keqeopl"}

### MySQL çš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆ?
{: id="20210330211653-99rmgmm"}

MySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ **REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰**ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡`SELECT @@tx_isolation;`å‘½ä»¤æ¥æŸ¥çœ‹ï¼ŒMySQL 8.0 è¯¥å‘½ä»¤æ”¹ä¸º`SELECT @@transaction_isolation;`
{: id="20210330211653-7j2bww4"}

```sql
mysql> SELECT @@tx_isolation;
+-----------------+
| @@tx_isolation  |
+-----------------+
| REPEATABLE-READ |
+-----------------+
```
{: id="20210330211653-k5qolyi"}

~~è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸ SQL æ ‡å‡†ä¸åŒçš„åœ°æ–¹åœ¨äº InnoDB å­˜å‚¨å¼•æ“åœ¨ **REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰** äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ä½¿ç”¨çš„æ˜¯ Next-Key Lock é”ç®—æ³•ï¼Œå› æ­¤å¯ä»¥é¿å…å¹»è¯»çš„äº§ç”Ÿï¼Œè¿™ä¸å…¶ä»–æ•°æ®åº“ç³»ç»Ÿ(å¦‚ SQL Server)æ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥è¯´ InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ **REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰** å·²ç»å¯ä»¥å®Œå…¨ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§è¦æ±‚ï¼Œå³è¾¾åˆ°äº† SQL æ ‡å‡†çš„ **SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)** éš”ç¦»çº§åˆ«ã€‚~~
{: id="20210330211653-dbjl0zu"}

ğŸ› é—®é¢˜æ›´æ­£ï¼š**MySQL InnoDB çš„ REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰å¹¶ä¸ä¿è¯é¿å…å¹»è¯»ï¼Œéœ€è¦åº”ç”¨ä½¿ç”¨åŠ é”è¯»æ¥ä¿è¯ã€‚è€Œè¿™ä¸ªåŠ é”åº¦ä½¿ç”¨åˆ°çš„æœºåˆ¶å°±æ˜¯ Next-Key Locksã€‚**
{: id="20210330211653-67f3kf9"}

å› ä¸ºéš”ç¦»çº§åˆ«è¶Šä½ï¼Œäº‹åŠ¡è¯·æ±‚çš„é”è¶Šå°‘ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»Ÿçš„éš”ç¦»çº§åˆ«éƒ½æ˜¯ **READ-COMMITTED(è¯»å–æäº¤å†…å®¹)** ï¼Œä½†æ˜¯ä½ è¦çŸ¥é“çš„æ˜¯ InnoDB å­˜å‚¨å¼•æ“é»˜è®¤ä½¿ç”¨ **REPEAaTABLE-READï¼ˆå¯é‡è¯»ï¼‰** å¹¶ä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½æŸå¤±ã€‚
{: id="20210330211653-g4a4jjj"}

InnoDB å­˜å‚¨å¼•æ“åœ¨ **åˆ†å¸ƒå¼äº‹åŠ¡** çš„æƒ…å†µä¸‹ä¸€èˆ¬ä¼šç”¨åˆ° **SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)** éš”ç¦»çº§åˆ«ã€‚
{: id="20210330211653-4tp1oqt"}

ğŸŒˆ æ‹“å±•ä¸€ä¸‹(ä»¥ä¸‹å†…å®¹æ‘˜è‡ªã€ŠMySQL æŠ€æœ¯å†…å¹•ï¼šInnoDB å­˜å‚¨å¼•æ“(ç¬¬ 2 ç‰ˆ)ã€‹7.7 ç« )ï¼š
{: id="20210330211653-nj6thu5"}

> InnoDB å­˜å‚¨å¼•æ“æä¾›äº†å¯¹ XA äº‹åŠ¡çš„æ”¯æŒï¼Œå¹¶é€šè¿‡ XA äº‹åŠ¡æ¥æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°ã€‚åˆ†å¸ƒå¼äº‹åŠ¡æŒ‡çš„æ˜¯å…è®¸å¤šä¸ªç‹¬ç«‹çš„äº‹åŠ¡èµ„æºï¼ˆtransactional resourcesï¼‰å‚ä¸åˆ°ä¸€ä¸ªå…¨å±€çš„äº‹åŠ¡ä¸­ã€‚äº‹åŠ¡èµ„æºé€šå¸¸æ˜¯å…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç±»å‹çš„èµ„æºã€‚å…¨å±€äº‹åŠ¡è¦æ±‚åœ¨å…¶ä¸­çš„æ‰€æœ‰å‚ä¸çš„äº‹åŠ¡è¦ä¹ˆéƒ½æäº¤ï¼Œè¦ä¹ˆéƒ½å›æ»šï¼Œè¿™å¯¹äºäº‹åŠ¡åŸæœ‰çš„ ACID è¦æ±‚åˆæœ‰äº†æé«˜ã€‚å¦å¤–ï¼Œåœ¨ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼ŒInnoDB å­˜å‚¨å¼•æ“çš„äº‹åŠ¡éš”ç¦»çº§åˆ«å¿…é¡»è®¾ç½®ä¸º SERIALIZABLEã€‚
> {: id="20210330211653-eyrxfxz"}
{: id="20210330211653-079tn5c"}

## å‚è€ƒ
{: id="20210330211653-3ijwjba"}

- {: id="20210330211653-ulxppw8"}ã€Šé«˜æ€§èƒ½ MySQLã€‹
  {: id="20210330211653-t4cb7bl"}
- {: id="20210330211653-dd8pidv"}https://www.omnisci.com/technical-glossary/relational-database
  {: id="20210330211653-xg3zprk"}
{: id="20210330211653-ys7vvyn"}


{: id="20210330211653-nn5a0h2" type="doc"}
