è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘æ ¹æ®å®˜æ–¹æ–‡æ¡£ä»¥åŠè‡ªå·±å¹³æ—¶çš„ä½¿ç”¨æƒ…å†µï¼Œå¯¹ Dubbo æ‰€åšçš„ä¸€ä¸ªæ€»ç»“ã€‚æ¬¢è¿è¡¥å……ï¼
{: id="20210330211656-pxt9qjw"}

## RPCåŸºç¡€
{: id="20210330211656-j493nll"}

### ä½•ä¸º RPC?
{: id="20210330211656-1pshdb5"}

**RPCï¼ˆRemote Procedure Callï¼‰** å³è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œé€šè¿‡åå­—æˆ‘ä»¬å°±èƒ½çœ‹å‡º RPC å…³æ³¨çš„æ˜¯è¿œç¨‹è°ƒç”¨è€Œéæœ¬åœ°è°ƒç”¨ã€‚
{: id="20210330211656-fqxj8da"}

**ä¸ºä»€ä¹ˆè¦ RPC  ï¼Ÿ** å› ä¸ºï¼Œä¸¤ä¸ªä¸åŒçš„æœåŠ¡å™¨ä¸Šçš„æœåŠ¡æä¾›çš„æ–¹æ³•ä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œç¼–ç¨‹æ‰èƒ½ä¼ é€’æ–¹æ³•è°ƒç”¨æ‰€éœ€è¦çš„å‚æ•°ã€‚å¹¶ä¸”ï¼Œæ–¹æ³•è°ƒç”¨çš„ç»“æœä¹Ÿéœ€è¦é€šè¿‡ç½‘ç»œç¼–ç¨‹æ¥æ¥æ”¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨ç½‘ç»œç¼–ç¨‹æ¥å®ç°è¿™ä¸ªè°ƒç”¨è¿‡ç¨‹çš„è¯å·¥ä½œé‡æ˜¯éå¸¸å¤§çš„ï¼Œå› ä¸ºï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘åº•å±‚ä¼ è¾“æ–¹å¼ï¼ˆTCPè¿˜æ˜¯UDPï¼‰ã€åºåˆ—åŒ–æ–¹å¼ç­‰ç­‰æ–¹é¢ã€‚
{: id="20210330211656-hobhg8x"}

**RPC èƒ½å¸®åŠ©æˆ‘ä»¬åšä»€ä¹ˆå‘¢ï¼Ÿ ** ç®€å•æ¥è¯´ï¼Œé€šè¿‡ RPC å¯ä»¥å¸®åŠ©æˆ‘ä»¬è°ƒç”¨è¿œç¨‹è®¡ç®—æœºä¸ŠæŸä¸ªæœåŠ¡çš„æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚å¹¶ä¸”ï¼æˆ‘ä»¬ä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œç¼–ç¨‹çš„å…·ä½“ç»†èŠ‚ã€‚
{: id="20210330211656-5k8bbbj"}

ä¸¾ä¸ªä¾‹å­ï¼šä¸¤ä¸ªä¸åŒçš„æœåŠ¡ Aã€B éƒ¨ç½²åœ¨ä¸¤å°ä¸åŒçš„æœºå™¨ä¸Šï¼ŒæœåŠ¡ A å¦‚æœæƒ³è¦è°ƒç”¨æœåŠ¡ B ä¸­çš„æŸä¸ªæ–¹æ³•çš„è¯å°±å¯ä»¥é€šè¿‡ RPC æ¥åšã€‚
{: id="20210330211656-4k93hf5"}

ä¸€è¨€è”½ä¹‹ï¼š**RPC çš„å‡ºç°å°±æ˜¯ä¸ºäº†è®©ä½ è°ƒç”¨è¿œç¨‹æ–¹æ³•åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚**
{: id="20210330211656-6wsqpcs"}

### RPC çš„åŸç†æ˜¯ä»€ä¹ˆ?
{: id="20210330211656-gb7sipx"}

ä¸ºäº†èƒ½å¤Ÿå¸®åŠ©å°ä¼™ä¼´ä»¬ç†è§£ RPC åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•´ä¸ª RPCçš„ æ ¸å¿ƒåŠŸèƒ½çœ‹ä½œæ˜¯ä¸‹é¢ğŸ‘‡ 6 ä¸ªéƒ¨åˆ†å®ç°çš„ï¼š
{: id="20210330211656-0i0cgtg"}

1. {: id="20210330211656-br1rcd9"}**å®¢æˆ·ç«¯ï¼ˆæœåŠ¡æ¶ˆè´¹ç«¯ï¼‰** ï¼šè°ƒç”¨è¿œç¨‹æ–¹æ³•çš„ä¸€ç«¯ã€‚
   {: id="20210330211656-ngdasng"}
2. {: id="20210330211656-2h9d8mw"}**å®¢æˆ·ç«¯ Stubï¼ˆæ¡©ï¼‰** ï¼š è¿™å…¶å®å°±æ˜¯ä¸€ä»£ç†ç±»ã€‚ä»£ç†ç±»ä¸»è¦åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠä½ è°ƒç”¨æ–¹æ³•ã€ç±»ã€æ–¹æ³•å‚æ•°ç­‰ä¿¡æ¯ä¼ é€’åˆ°æœåŠ¡ç«¯ã€‚
   {: id="20210330211656-qmpxrpn"}
3. {: id="20210330211656-547c2zw"}**ç½‘ç»œä¼ è¾“** ï¼š ç½‘ç»œä¼ è¾“å°±æ˜¯ä½ è¦æŠŠä½ è°ƒç”¨çš„æ–¹æ³•çš„ä¿¡æ¯æ¯”å¦‚è¯´å‚æ•°å•Šè¿™äº›ä¸œè¥¿ä¼ è¾“åˆ°æœåŠ¡ç«¯ï¼Œç„¶åæœåŠ¡ç«¯æ‰§è¡Œå®Œä¹‹åå†æŠŠè¿”å›ç»“æœé€šè¿‡ç½‘ç»œä¼ è¾“ç»™ä½ ä¼ è¾“å›æ¥ã€‚ç½‘ç»œä¼ è¾“çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§æ¯”å¦‚æœ€è¿‘åŸºæœ¬çš„ Socketæˆ–è€…æ€§èƒ½ä»¥åŠå°è£…æ›´åŠ ä¼˜ç§€çš„ Nettyï¼ˆæ¨èï¼‰ã€‚
   {: id="20210330211656-tzghwpa"}
4. {: id="20210330211656-rmqhrch"}**æœåŠ¡ç«¯ Stubï¼ˆæ¡©ï¼‰** ï¼šè¿™ä¸ªæ¡©å°±ä¸æ˜¯ä»£ç†ç±»äº†ã€‚æˆ‘è§‰å¾—ç†è§£ä¸ºæ¡©å®é™…ä¸å¤ªå¥½ï¼Œå¤§å®¶æ³¨æ„ä¸€ä¸‹å°±å¥½ã€‚è¿™é‡Œçš„æœåŠ¡ç«¯ Stub å®é™…æŒ‡çš„å°±æ˜¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ‰§è¡Œæ–¹æ³•çš„è¯·æ±‚åï¼Œå»æŒ‡å®šå¯¹åº”çš„æ–¹æ³•ç„¶åè¿”å›ç»“æœç»™å®¢æˆ·ç«¯çš„ç±»ã€‚
   {: id="20210330211656-w3jf3u2"}
5. {: id="20210330211656-otiehu9"}**æœåŠ¡ç«¯ï¼ˆæœåŠ¡æä¾›ç«¯ï¼‰** ï¼šæä¾›è¿œç¨‹æ–¹æ³•çš„ä¸€ç«¯ã€‚
   {: id="20210330211656-t2wuzhq"}
{: id="20210330211656-r1ugybd"}

å…·ä½“åŸç†å›¾å¦‚ä¸‹ï¼Œåé¢æˆ‘ä¼šä¸²èµ·æ¥å°†æ•´ä¸ªRPCçš„è¿‡ç¨‹ç»™å¤§å®¶è¯´ä¸€ä¸‹ã€‚
{: id="20210330211656-0vvppfg"}

![RPCåŸç†å›¾](http://my-blog-to-use.oss-cn-beijing.aliyuncs.com/18-12-6/37345851.jpg)
{: id="20210330211656-k677io2"}

1. {: id="20210330211656-cl3wrzj"}æœåŠ¡æ¶ˆè´¹ç«¯ï¼ˆclientï¼‰ä»¥æœ¬åœ°è°ƒç”¨çš„æ–¹å¼è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼›
   {: id="20210330211656-bjnoode"}
2. {: id="20210330211656-v3rudqd"}å®¢æˆ·ç«¯ Stubï¼ˆclient stubï¼‰ æ¥æ”¶åˆ°è°ƒç”¨åè´Ÿè´£å°†æ–¹æ³•ã€å‚æ•°ç­‰ç»„è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ï¼ˆåºåˆ—åŒ–ï¼‰ï¼š`RpcRequest`ï¼›
   {: id="20210330211656-rhp7bus"}
3. {: id="20210330211656-7tp8xd8"}å®¢æˆ·ç«¯ Stubï¼ˆclient stubï¼‰ æ‰¾åˆ°è¿œç¨‹æœåŠ¡çš„åœ°å€ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡æä¾›ç«¯ï¼›
   {: id="20210330211656-mj3fz2y"}
4. {: id="20210330211656-ajvonx6"}æœåŠ¡ç«¯ Stubï¼ˆæ¡©ï¼‰æ”¶åˆ°æ¶ˆæ¯å°†æ¶ˆæ¯ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡: `RpcRequest`ï¼›
   {: id="20210330211656-8rmr4ba"}
5. {: id="20210330211656-mhrq1tk"}æœåŠ¡ç«¯ Stubï¼ˆæ¡©ï¼‰æ ¹æ®`RpcRequest`ä¸­çš„ç±»ã€æ–¹æ³•ã€æ–¹æ³•å‚æ•°ç­‰ä¿¡æ¯è°ƒç”¨æœ¬åœ°çš„æ–¹æ³•ï¼›
   {: id="20210330211656-kjgu9es"}
6. {: id="20210330211656-rfma6h4"}æœåŠ¡ç«¯ Stubï¼ˆæ¡©ï¼‰å¾—åˆ°æ–¹æ³•æ‰§è¡Œç»“æœå¹¶å°†ç»„è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ï¼š`RpcResponse`ï¼ˆåºåˆ—åŒ–ï¼‰å‘é€è‡³æ¶ˆè´¹æ–¹ï¼›
   {: id="20210330211656-yr36t4g"}
7. {: id="20210330211656-gib4750"}å®¢æˆ·ç«¯ Stubï¼ˆclient stubï¼‰æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶å°†æ¶ˆæ¯ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡:`RpcResponse` ï¼Œè¿™æ ·ä¹Ÿå°±å¾—åˆ°äº†æœ€ç»ˆç»“æœã€‚over!
   {: id="20210330211656-au7bap6"}
{: id="20210330211656-clgfjsj"}

ç›¸ä¿¡å°ä¼™ä¼´ä»¬çœ‹å®Œä¸Šé¢çš„è®²è§£ä¹‹åï¼Œå·²ç»äº†è§£äº† RPC çš„åŸç†ã€‚
{: id="20210330211656-4f39paq"}

è™½ç„¶ç¯‡å¹…ä¸å¤šï¼Œä½†æ˜¯åŸºæœ¬æŠŠ RPC æ¡†æ¶çš„æ ¸å¿ƒåŸç†è®²æ¸…æ¥šäº†ï¼å¦å¤–ï¼Œå¯¹äºä¸Šé¢çš„æŠ€æœ¯ç»†èŠ‚ï¼Œæˆ‘ä¼šåœ¨åé¢çš„ç« èŠ‚ä»‹ç»åˆ°ã€‚
{: id="20210330211656-qeejyya"}

**æœ€åï¼Œå¯¹äº RPC çš„åŸç†ï¼Œå¸Œæœ›å°ä¼™ä¼´ä¸å•å•è¦ç†è§£ï¼Œè¿˜è¦èƒ½å¤Ÿè‡ªå·±ç”»å‡ºæ¥å¹¶ä¸”èƒ½å¤Ÿç»™åˆ«äººè®²å‡ºæ¥ã€‚å› ä¸ºï¼Œåœ¨é¢è¯•ä¸­è¿™ä¸ªé—®é¢˜åœ¨é¢è¯•å®˜é—®åˆ° RPC ç›¸å…³å†…å®¹çš„æ—¶å€™åŸºæœ¬éƒ½ä¼šç¢°åˆ°ã€‚**
{: id="20210330211656-3y6p4kp"}

## DubboåŸºç¡€
{: id="20210330211656-1vj5jb3"}

### ä»€ä¹ˆæ˜¯ Dubbo?
{: id="20210330211656-xru08qd"}

![](https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2020-8/427f2168-1930-4c14-8760-415fac8db1d0-20200802184737978.png)
{: id="20210330211656-yxm9wli"}

[Apache Dubbo](https://github.com/apache/incubator-dubbo) (incubating) |ËˆdÊŒbÉ™ÊŠ|  æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½ã€è½»é‡çº§çš„å¼€æº Java RPC æ¡†æ¶ã€‚
{: id="20210330211656-spopodk"}

æ ¹æ® [Dubbo å®˜æ–¹æ–‡æ¡£](https://dubbo.apache.org/zh/)çš„ä»‹ç»ï¼ŒDubbo æä¾›äº†å…­å¤§æ ¸å¿ƒèƒ½åŠ›
{: id="20210330211656-ewyhxmu"}

1. {: id="20210330211656-jiqc9zi"}é¢å‘æ¥å£ä»£ç†çš„é«˜æ€§èƒ½RPCè°ƒç”¨ã€‚
   {: id="20210330211656-905qiev"}
2. {: id="20210330211656-s55xoot"}æ™ºèƒ½å®¹é”™å’Œè´Ÿè½½å‡è¡¡ã€‚
   {: id="20210330211656-ivhhkp4"}
3. {: id="20210330211656-hvx8bd2"}æœåŠ¡è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°ã€‚
   {: id="20210330211656-eiizec4"}
4. {: id="20210330211656-2hy030e"}é«˜åº¦å¯æ‰©å±•èƒ½åŠ›ã€‚
   {: id="20210330211656-2knguo6"}
5. {: id="20210330211656-q77pz8a"}è¿è¡ŒæœŸæµé‡è°ƒåº¦ã€‚
   {: id="20210330211656-fr0rchq"}
6. {: id="20210330211656-gjdc0xd"}å¯è§†åŒ–çš„æœåŠ¡æ²»ç†ä¸è¿ç»´ã€‚
   {: id="20210330211656-m5p33xi"}
{: id="20210330211656-mzaw2js"}

![Dubboæä¾›çš„å…­å¤§æ ¸å¿ƒèƒ½åŠ›](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/%E6%BA%90%E7%A0%81/dubbo/dubbo%E6%8F%90%E4%BE%9B%E7%9A%84%E5%85%AD%E5%A4%A7%E6%A0%B8%E5%BF%83%E8%83%BD%E5%8A%9B.png)
{: id="20210330211656-pq4jy3i"}

ç®€å•æ¥è¯´å°±æ˜¯ï¼š **Dubbo ä¸å…‰å¯ä»¥å¸®åŠ©æˆ‘ä»¬è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œè¿˜æä¾›äº†ä¸€äº›å…¶ä»–å¼€ç®±å³ç”¨çš„åŠŸèƒ½æ¯”å¦‚æ™ºèƒ½è´Ÿè½½å‡è¡¡ã€‚**
{: id="20210330211656-jkywtay"}

Dubbo ç›®å‰å·²ç»æœ‰æ¥è¿‘ 34.4 k çš„ Star  ã€‚
{: id="20210330211656-fijp5sh"}

åœ¨ **2020 å¹´åº¦ OSC ä¸­å›½å¼€æºé¡¹ç›®** è¯„é€‰æ´»åŠ¨ä¸­ï¼ŒDubbo ä½åˆ—å¼€å‘æ¡†æ¶å’ŒåŸºç¡€ç»„ä»¶ç±»é¡¹ç›®çš„ç¬¬7åã€‚æƒ³æ¯”å‡ å¹´å‰æ¥è¯´ï¼Œçƒ­åº¦å’Œæ’åæœ‰æ‰€ä¸‹é™ã€‚
{: id="20210330211656-6v7vs7e"}

![](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/%E6%BA%90%E7%A0%81/dubbo/image-20210107153159545.png)
{: id="20210330211656-fwwt6h3"}

Dubbo æ˜¯ç”±é˜¿é‡Œå¼€æºï¼Œåæ¥åŠ å…¥äº† Apache ã€‚æ­£å¼ç”±äº Dubbo çš„å‡ºç°ï¼Œæ‰ä½¿å¾—è¶Šæ¥è¶Šå¤šçš„å…¬å¸å¼€å§‹ä½¿ç”¨ä»¥åŠæ¥å—åˆ†å¸ƒå¼æ¶æ„ã€‚
{: id="20210330211656-edvaolg"}

### ä¸ºä»€ä¹ˆè¦ç”¨ Dubbo?
{: id="20210330211656-vfl4517"}

éšç€äº’è”ç½‘çš„å‘å±•ï¼Œç½‘ç«™çš„è§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œç”¨æˆ·æ•°é‡è¶Šæ¥è¶Šå¤šã€‚å•ä¸€åº”ç”¨æ¶æ„ ã€å‚ç›´åº”ç”¨æ¶æ„æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œè¿™ä¸ªæ—¶å€™åˆ†å¸ƒå¼æœåŠ¡æ¶æ„å°±è¯ç”Ÿäº†ã€‚
{: id="20210330211656-el9ija8"}

åˆ†å¸ƒå¼æœåŠ¡æ¶æ„ä¸‹ï¼Œç³»ç»Ÿè¢«æ‹†åˆ†æˆä¸åŒçš„æœåŠ¡æ¯”å¦‚çŸ­ä¿¡æœåŠ¡ã€å®‰å…¨æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡ç‹¬ç«‹æä¾›ç³»ç»Ÿçš„æŸä¸ªæ ¸å¿ƒæœåŠ¡ã€‚
{: id="20210330211656-opsy6qx"}

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Java RMIï¼ˆJava Remote Method Invocationï¼‰ã€Hessianè¿™ç§æ”¯æŒè¿œç¨‹è°ƒç”¨çš„æ¡†æ¶æ¥ç®€å•åœ°æš´éœ²å’Œå¼•ç”¨è¿œç¨‹æœåŠ¡ã€‚ä½†æ˜¯ï¼å½“æœåŠ¡è¶Šæ¥è¶Šå¤šä¹‹åï¼ŒæœåŠ¡è°ƒç”¨å…³ç³»è¶Šæ¥è¶Šå¤æ‚ã€‚å½“åº”ç”¨è®¿é—®å‹åŠ›è¶Šæ¥è¶Šå¤§åï¼Œè´Ÿè½½å‡è¡¡ä»¥åŠæœåŠ¡ç›‘æ§çš„éœ€æ±‚ä¹Ÿè¿«åœ¨çœ‰ç«ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ F5 è¿™ç±»ç¡¬ä»¶æ¥åšè´Ÿè½½å‡è¡¡ï¼Œä½†è¿™æ ·å¢åŠ äº†æˆæœ¬ï¼Œå¹¶ä¸”å­˜åœ¨å•ç‚¹æ•…éšœçš„é£é™©ã€‚
{: id="20210330211656-cl1u7p8"}

ä¸è¿‡ï¼ŒDubbo çš„å‡ºç°è®©ä¸Šè¿°é—®é¢˜å¾—åˆ°äº†è§£å†³ã€‚**Dubbo å¸®åŠ©æˆ‘ä»¬è§£å†³äº†ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ**
{: id="20210330211656-zp7ngrw"}

1. {: id="20210330211656-6zmkq99"}**è´Ÿè½½å‡è¡¡** ï¼š åŒä¸€ä¸ªæœåŠ¡éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨æ—¶è¯¥è°ƒç”¨é‚£ä¸€å°æœºå™¨ä¸Šçš„æœåŠ¡ã€‚
   {: id="20210330211656-shmjivc"}
2. {: id="20210330211656-7y6vwty"}**æœåŠ¡è°ƒç”¨é“¾è·¯ç”Ÿæˆ**  ï¼š éšç€ç³»ç»Ÿçš„å‘å±•ï¼ŒæœåŠ¡è¶Šæ¥è¶Šå¤šï¼ŒæœåŠ¡é—´ä¾èµ–å…³ç³»å˜å¾—é”™è¸ªå¤æ‚ï¼Œç”šè‡³åˆ†ä¸æ¸…å“ªä¸ªåº”ç”¨è¦åœ¨å“ªä¸ªåº”ç”¨ä¹‹å‰å¯åŠ¨ï¼Œæ¶æ„å¸ˆéƒ½ä¸èƒ½å®Œæ•´çš„æè¿°åº”ç”¨çš„æ¶æ„å…³ç³»ã€‚Dubbo å¯ä»¥ä¸ºæˆ‘ä»¬è§£å†³æœåŠ¡ä¹‹é—´äº’ç›¸æ˜¯å¦‚ä½•è°ƒç”¨çš„ã€‚
   {: id="20210330211656-exaxc9y"}
3. {: id="20210330211656-yt4re70"}**æœåŠ¡è®¿é—®å‹åŠ›ä»¥åŠæ—¶é•¿ç»Ÿè®¡ã€èµ„æºè°ƒåº¦å’Œæ²»ç†** ï¼šåŸºäºè®¿é—®å‹åŠ›å®æ—¶ç®¡ç†é›†ç¾¤å®¹é‡ï¼Œæé«˜é›†ç¾¤åˆ©ç”¨ç‡ã€‚
   {: id="20210330211656-yc29gcl"}
4. {: id="20210330211656-tcvmz9l"}......
   {: id="20210330211656-xm3esub"}
{: id="20210330211656-qzzxz2a"}

![](http://my-blog-to-use.oss-cn-beijing.aliyuncs.com/18-9-26/43050183.jpg)
{: id="20210330211656-ewta91r"}

å¦å¤–ï¼ŒDubbo é™¤äº†èƒ½å¤Ÿåº”ç”¨åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¹Ÿå¯ä»¥åº”ç”¨åœ¨ç°åœ¨æ¯”è¾ƒç«çš„å¾®æœåŠ¡ç³»ç»Ÿä¸­ã€‚ä¸è¿‡ï¼Œç”±äº Spring Cloud åœ¨å¾®æœåŠ¡ä¸­åº”ç”¨æ›´åŠ å¹¿æ³›ï¼Œæ‰€ä»¥ï¼Œæˆ‘è§‰å¾—ä¸€èˆ¬æˆ‘ä»¬æ Dubbo çš„è¯ï¼Œå¤§éƒ¨åˆ†æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æƒ…å†µã€‚
{: id="20210330211656-82mucva"}

**æˆ‘ä»¬åˆšåˆšæåˆ°äº†åˆ†å¸ƒå¼è¿™ä¸ªæ¦‚å¿µï¼Œä¸‹é¢å†ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ï¼Ÿä¸ºä»€ä¹ˆè¦åˆ†å¸ƒå¼ï¼Ÿ**
{: id="20210330211656-nlkmbid"}

## åˆ†å¸ƒå¼åŸºç¡€
{: id="20210330211656-qhki7bl"}

### ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼?
{: id="20210330211656-wxvips8"}

åˆ†å¸ƒå¼æˆ–è€…è¯´ SOA åˆ†å¸ƒå¼é‡è¦çš„å°±æ˜¯é¢å‘æœåŠ¡ï¼Œè¯´ç®€å•çš„åˆ†å¸ƒå¼å°±æ˜¯æˆ‘ä»¬æŠŠæ•´ä¸ªç³»ç»Ÿæ‹†åˆ†æˆä¸åŒçš„æœåŠ¡ç„¶åå°†è¿™äº›æœåŠ¡æ”¾åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šå‡è½»å•ä½“æœåŠ¡çš„å‹åŠ›æé«˜å¹¶å‘é‡å’Œæ€§èƒ½ã€‚æ¯”å¦‚ç”µå•†ç³»ç»Ÿå¯ä»¥ç®€å•åœ°æ‹†åˆ†æˆè®¢å•ç³»ç»Ÿã€å•†å“ç³»ç»Ÿã€ç™»å½•ç³»ç»Ÿç­‰ç­‰ï¼Œæ‹†åˆ†ä¹‹åçš„æ¯ä¸ªæœåŠ¡å¯ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œå¦‚æœæŸä¸€ä¸ªæœåŠ¡çš„è®¿é—®é‡æ¯”è¾ƒå¤§çš„è¯ä¹Ÿå¯ä»¥å°†è¿™ä¸ªæœåŠ¡åŒæ—¶éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šã€‚
{: id="20210330211656-yfms9li"}

![åˆ†å¸ƒå¼äº‹åŠ¡ç¤ºæ„å›¾](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/java-guide-blog/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%A4%BA%E6%84%8F%E5%9B%BE.png)
{: id="20210330211656-ht9uwgm"}

### ä¸ºä»€ä¹ˆè¦åˆ†å¸ƒå¼?
{: id="20210330211656-n4oqpnb"}

ä»å¼€å‘è§’åº¦æ¥è®²å•ä½“åº”ç”¨çš„ä»£ç éƒ½é›†ä¸­åœ¨ä¸€èµ·ï¼Œè€Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä»£ç æ ¹æ®ä¸šåŠ¡è¢«æ‹†åˆ†ã€‚æ‰€ä»¥ï¼Œæ¯ä¸ªå›¢é˜Ÿå¯ä»¥è´Ÿè´£ä¸€ä¸ªæœåŠ¡çš„å¼€å‘ï¼Œè¿™æ ·æå‡äº†å¼€å‘æ•ˆç‡ã€‚å¦å¤–ï¼Œä»£ç æ ¹æ®ä¸šåŠ¡æ‹†åˆ†ä¹‹åæ›´åŠ ä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚
{: id="20210330211656-1h5sdfa"}

å¦å¤–ï¼Œæˆ‘è§‰å¾—å°†ç³»ç»Ÿæ‹†åˆ†æˆåˆ†å¸ƒå¼ä¹‹åä¸å…‰ä¾¿äºç³»ç»Ÿæ‰©å±•å’Œç»´æŠ¤ï¼Œæ›´èƒ½æé«˜æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ã€‚ä½ æƒ³ä¸€æƒ³å˜›ï¼ŸæŠŠæ•´ä¸ªç³»ç»Ÿæ‹†åˆ†æˆä¸åŒçš„æœåŠ¡/ç³»ç»Ÿï¼Œç„¶åæ¯ä¸ªæœåŠ¡/ç³»ç»Ÿ å•ç‹¬éƒ¨ç½²åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œæ˜¯ä¸æ˜¯å¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜äº†ç³»ç»Ÿæ€§èƒ½å‘¢ï¼Ÿ
{: id="20210330211656-1vix5is"}

## Dubbo æ¶æ„
{: id="20210330211656-4ac4wor"}

### Dubbo æ¶æ„ä¸­çš„æ ¸å¿ƒè§’è‰²æœ‰å“ªäº›ï¼Ÿ
{: id="20210330211656-ajirzjf"}

[å®˜æ–¹æ–‡æ¡£ä¸­çš„æ¡†æ¶è®¾è®¡ç« èŠ‚](https://dubbo.apache.org/zh/docs/v2.7/dev/design/) å·²ç»ä»‹ç»çš„éå¸¸è¯¦ç»†äº†ï¼Œæˆ‘è¿™é‡ŒæŠŠä¸€äº›æ¯”è¾ƒé‡è¦çš„ç‚¹å†æä¸€ä¸‹ã€‚
{: id="20210330211656-4kdd0be"}

![dubbo-relation](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/%E6%BA%90%E7%A0%81/dubbo/dubbo-relation.jpg)
{: id="20210330211656-nyvbaqw"}

ä¸Šè¿°èŠ‚ç‚¹ç®€å•ä»‹ç»ä»¥åŠä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼š
{: id="20210330211656-44mxaza"}

- {: id="20210330211656-yw2y9f9"}**Containerï¼š** æœåŠ¡è¿è¡Œå®¹å™¨ï¼Œè´Ÿè´£åŠ è½½ã€è¿è¡ŒæœåŠ¡æä¾›è€…ã€‚å¿…é¡»ã€‚
  {: id="20210330211656-sgl1fxz"}
- {: id="20210330211656-ilh3smm"}**Providerï¼š** æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ï¼Œä¼šå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚å¿…é¡»ã€‚
  {: id="20210330211656-w94lwla"}
- {: id="20210330211656-vvybjbn"}**Consumerï¼š** è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ï¼Œä¼šå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚å¿…é¡»ã€‚
  {: id="20210330211656-vganv55"}
- {: id="20210330211656-y869rhg"}**Registryï¼š** æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒã€‚æ³¨å†Œä¸­å¿ƒä¼šè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ã€‚éå¿…é¡»ã€‚
  {: id="20210330211656-f0j53ls"}
- {: id="20210330211656-fz06zt7"}**Monitorï¼š** ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒã€‚æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ä¼šå®šæ—¶å‘é€ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚ éå¿…é¡»ã€‚
  {: id="20210330211656-cfls4k6"}
{: id="20210330211656-k9ngbvj"}

### Dubbo ä¸­çš„ Invoker æ¦‚å¿µäº†è§£ä¹ˆï¼Ÿ
{: id="20210330211656-6obmf5i"}

`Invoker` æ˜¯ Dubbo é¢†åŸŸæ¨¡å‹ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œä½ å¦‚æœé˜…è¯»è¿‡ Dubbo æºç çš„è¯ï¼Œä½ ä¼šæ— æ•°æ¬¡çœ‹åˆ°è¿™ç©æ„ã€‚å°±æ¯”å¦‚ä¸‹é¢æˆ‘è¦è¯´çš„è´Ÿè½½å‡è¡¡è¿™å—çš„æºç ä¸­å°±æœ‰å¤§é‡ `Invoker` çš„èº«å½±ã€‚
{: id="20210330211656-gjl89m1"}

ç®€å•æ¥è¯´ï¼Œ`Invoker` å°±æ˜¯ Dubbo å¯¹è¿œç¨‹è°ƒç”¨çš„æŠ½è±¡ã€‚
{: id="20210330211656-me4mz0c"}

![dubbo_rpc_invoke.jpg](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/java-guide-blog/dubbo_rpc_invoke.jpg)
{: id="20210330211656-o3qpmvn"}

æŒ‰ç…§ Dubbo å®˜æ–¹çš„è¯æ¥è¯´ï¼Œ`Invoker`  åˆ†ä¸º
{: id="20210330211656-tpgwtzp"}

- {: id="20210330211656-iyfb5fn"}æœåŠ¡æä¾› `Invoker`
  {: id="20210330211656-gzmhjb5"}
- {: id="20210330211656-71h3sp8"}æœåŠ¡æ¶ˆè´¹ `Invoker`
  {: id="20210330211656-ch2o2r2"}
{: id="20210330211656-1c53gwr"}

å‡å¦‚æˆ‘ä»¬éœ€è¦è°ƒç”¨ä¸€ä¸ªè¿œç¨‹æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦åŠ¨æ€ä»£ç†æ¥å±è”½è¿œç¨‹è°ƒç”¨çš„ç»†èŠ‚å§ï¼æˆ‘ä»¬å±è”½æ‰çš„è¿™äº›ç»†èŠ‚å°±ä¾èµ–å¯¹åº”çš„ `Invoker`  å®ç°ï¼Œ `Invoker` å®ç°äº†çœŸæ­£çš„è¿œç¨‹æœåŠ¡è°ƒç”¨ã€‚
{: id="20210330211656-ialjkhu"}

### Dubbo çš„å·¥ä½œåŸç†äº†è§£ä¹ˆï¼Ÿ
{: id="20210330211656-d0prm03"}

ä¸‹å›¾æ˜¯ Dubbo çš„æ•´ä½“è®¾è®¡ï¼Œä»ä¸‹è‡³ä¸Šåˆ†ä¸ºåå±‚ï¼Œå„å±‚å‡ä¸ºå•å‘ä¾èµ–ã€‚
{: id="20210330211656-nj6qyys"}

> å·¦è¾¹æ·¡è“èƒŒæ™¯çš„ä¸ºæœåŠ¡æ¶ˆè´¹æ–¹ä½¿ç”¨çš„æ¥å£ï¼Œå³è¾¹æ·¡ç»¿è‰²èƒŒæ™¯çš„ä¸ºæœåŠ¡æä¾›æ–¹ä½¿ç”¨çš„æ¥å£ï¼Œä½äºä¸­è½´çº¿ä¸Šçš„ä¸ºåŒæ–¹éƒ½ç”¨åˆ°çš„æ¥å£ã€‚
> {: id="20210330211656-nel7geb"}
{: id="20210330211656-u8kc3vo"}

![dubbo-framework](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/source-code/dubbo/dubbo-framework.jpg)
{: id="20210330211656-s76cnek"}

- {: id="20210330211656-0p7vnzk"}**config é…ç½®å±‚**ï¼šDubboç›¸å…³çš„é…ç½®ã€‚æ”¯æŒä»£ç é…ç½®ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒåŸºäº Spring  æ¥åšé…ç½®ï¼Œä»¥ `ServiceConfig`, `ReferenceConfig` ä¸ºä¸­å¿ƒ
  {: id="20210330211656-uqy2nm0"}
- {: id="20210330211656-qvuru0i"}**proxy æœåŠ¡ä»£ç†å±‚**ï¼šè°ƒç”¨è¿œç¨‹æ–¹æ³•åƒè°ƒç”¨æœ¬åœ°çš„æ–¹æ³•ä¸€æ ·ç®€å•çš„ä¸€ä¸ªå…³é”®ï¼ŒçœŸå®è°ƒç”¨è¿‡ç¨‹ä¾èµ–ä»£ç†ç±»ï¼Œä»¥ `ServiceProxy` ä¸ºä¸­å¿ƒã€‚
  {: id="20210330211656-hshceyn"}
- {: id="20210330211656-3xjoslj"}**registry æ³¨å†Œä¸­å¿ƒå±‚**ï¼šå°è£…æœåŠ¡åœ°å€çš„æ³¨å†Œä¸å‘ç°ã€‚
  {: id="20210330211656-a5cav1z"}
- {: id="20210330211656-5917kpx"}**cluster è·¯ç”±å±‚**ï¼šå°è£…å¤šä¸ªæä¾›è€…çš„è·¯ç”±åŠè´Ÿè½½å‡è¡¡ï¼Œå¹¶æ¡¥æ¥æ³¨å†Œä¸­å¿ƒï¼Œä»¥ `Invoker` ä¸ºä¸­å¿ƒã€‚
  {: id="20210330211656-lzzavzz"}
- {: id="20210330211656-i238pfg"}**monitor ç›‘æ§å±‚**ï¼šRPC è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ç›‘æ§ï¼Œä»¥ `Statistics` ä¸ºä¸­å¿ƒã€‚
  {: id="20210330211656-torwg9g"}
- {: id="20210330211656-yc6yaxu"}**protocol è¿œç¨‹è°ƒç”¨å±‚**ï¼šå°è£… RPC è°ƒç”¨ï¼Œä»¥ `Invocation`, `Result` ä¸ºä¸­å¿ƒã€‚
  {: id="20210330211656-ql2zye6"}
- {: id="20210330211656-73ft232"}**exchange ä¿¡æ¯äº¤æ¢å±‚**ï¼šå°è£…è¯·æ±‚å“åº”æ¨¡å¼ï¼ŒåŒæ­¥è½¬å¼‚æ­¥ï¼Œä»¥ `Request`, `Response` ä¸ºä¸­å¿ƒã€‚
  {: id="20210330211656-5lhelua"}
- {: id="20210330211656-ejng7gy"}**transport ç½‘ç»œä¼ è¾“å±‚**ï¼šæŠ½è±¡ mina å’Œ netty ä¸ºç»Ÿä¸€æ¥å£ï¼Œä»¥ `Message` ä¸ºä¸­å¿ƒã€‚
  {: id="20210330211656-j4hdqvh"}
- {: id="20210330211656-gh4a72x"}**serialize æ•°æ®åºåˆ—åŒ–å±‚** ï¼šå¯¹éœ€è¦åœ¨ç½‘ç»œä¼ è¾“çš„æ•°æ®è¿›è¡Œåºåˆ—åŒ–ã€‚
  {: id="20210330211656-7kgcikr"}
{: id="20210330211656-qzo17pn"}

### Dubbo çš„ SPI æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ å¦‚ä½•æ‰©å±• Dubbo ä¸­çš„é»˜è®¤å®ç°ï¼Ÿ
{: id="20210330211656-4tzhdn8"}

SPIï¼ˆService Provider Interfaceï¼‰ æœºåˆ¶è¢«å¤§é‡ç”¨åœ¨å¼€æºé¡¹ç›®ä¸­ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬åŠ¨æ€å¯»æ‰¾æœåŠ¡/åŠŸèƒ½ï¼ˆæ¯”å¦‚è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼‰çš„å®ç°ã€‚
{: id="20210330211656-804cvdn"}

SPI çš„å…·ä½“åŸç†æ˜¯è¿™æ ·çš„ï¼šæˆ‘ä»¬å°†æ¥å£çš„å®ç°ç±»æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è¯»å–é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡åå°„åŠ è½½å®ç°ç±»ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œçš„æ—¶å€™ï¼ŒåŠ¨æ€æ›¿æ¢æ¥å£çš„å®ç°ç±»ã€‚å’Œ IoC çš„è§£è€¦æ€æƒ³æ˜¯ç±»ä¼¼çš„ã€‚
{: id="20210330211656-eet7my2"}

Java æœ¬èº«å°±æä¾›äº† SPI æœºåˆ¶çš„å®ç°ã€‚ä¸è¿‡ï¼ŒDubbo æ²¡æœ‰ç›´æ¥ç”¨ï¼Œè€Œæ˜¯å¯¹ JavaåŸç”Ÿçš„ SPIæœºåˆ¶è¿›è¡Œäº†å¢å¼ºï¼Œä»¥ä¾¿æ›´å¥½æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ã€‚
{: id="20210330211656-7h8wez2"}

**é‚£æˆ‘ä»¬å¦‚ä½•æ‰©å±• Dubbo ä¸­çš„é»˜è®¤å®ç°å‘¢ï¼Ÿ**
{: id="20210330211656-ipr816y"}

æ¯”å¦‚è¯´æˆ‘ä»¬æƒ³è¦å®ç°è‡ªå·±çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæˆ‘ä»¬åˆ›å»ºå¯¹åº”çš„å®ç°ç±» `XxxLoadBalance` å®ç° `LoadBalance` æ¥å£æˆ–è€… `AbstractLoadBalance` ç±»ã€‚
{: id="20210330211656-pg0sivo"}

```java
package com.xxx;
 
import org.apache.dubbo.rpc.cluster.LoadBalance;
import org.apache.dubbo.rpc.Invoker;
import org.apache.dubbo.rpc.Invocation;
import org.apache.dubbo.rpc.RpcException; 
 
public class XxxLoadBalance implements LoadBalance {
    public <T> Invoker<T> select(List<Invoker<T>> invokers, Invocation invocation) throws RpcException {
        // ...
    }
}
```
{: id="20210330211656-dq2l4ac"}

æˆ‘ä»¬å°†è¿™ä¸ªæ˜¯å®ç°ç±»çš„è·¯å¾„å†™å…¥åˆ°`resources` ç›®å½•ä¸‹çš„ `META-INF/dubbo/org.apache.dubbo.rpc.cluster.LoadBalance`æ–‡ä»¶ä¸­å³å¯ã€‚
{: id="20210330211656-fgqda05"}

```java
src
 |-main
    |-java
        |-com
            |-xxx
                |-XxxLoadBalance.java (å®ç°LoadBalanceæ¥å£)
    |-resources
        |-META-INF
            |-dubbo
                |-org.apache.dubbo.rpc.cluster.LoadBalance (çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼šxxx=com.xxx.XxxLoadBalance)
```
{: id="20210330211656-bol1tn7"}

`org.apache.dubbo.rpc.cluster.LoadBalance`
{: id="20210330211656-e67rivj"}

```
xxx=com.xxx.XxxLoadBalance
```
{: id="20210330211656-px2gsr5"}

å…¶ä»–è¿˜æœ‰å¾ˆå¤šå¯ä¾›æ‰©å±•çš„é€‰æ‹©ï¼Œä½ å¯ä»¥åœ¨[å®˜æ–¹æ–‡æ¡£@SPIæ‰©å±•å®ç°](https://dubbo.apache.org/zh/docs/v2.7/dev/impls/)è¿™é‡Œæ‰¾åˆ°ã€‚
{: id="20210330211656-q9j2diu"}

![](https://img-blog.csdnimg.cn/20210328091015555.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0MzM3Mjcy,size_16,color_FFFFFF,t_70)
{: id="20210330211656-06fcbeu"}

### Dubbo çš„å¾®å†…æ ¸æ¶æ„äº†è§£å—ï¼Ÿ
{: id="20210330211656-svuwidt"}

Dubbo é‡‡ç”¨ å¾®å†…æ ¸ï¼ˆMicrokernelï¼‰ + æ’ä»¶ï¼ˆPluginï¼‰ æ¨¡å¼ï¼Œç®€å•æ¥è¯´å°±æ˜¯å¾®å†…æ ¸æ¶æ„ã€‚å¾®å†…æ ¸åªè´Ÿè´£ç»„è£…æ’ä»¶ã€‚
{: id="20210330211656-1rvtdno"}

**ä½•ä¸ºå¾®å†…æ ¸æ¶æ„å‘¢ï¼Ÿ** ã€Šè½¯ä»¶æ¶æ„æ¨¡å¼ã€‹ è¿™æœ¬ä¹¦æ˜¯è¿™æ ·ä»‹ç»çš„ï¼š
{: id="20210330211656-rvp2za6"}

> å¾®å†…æ ¸æ¶æ„æ¨¡å¼ï¼ˆæœ‰æ—¶è¢«ç§°ä¸ºæ’ä»¶æ¶æ„æ¨¡å¼ï¼‰æ˜¯å®ç°åŸºäºäº§å“åº”ç”¨ç¨‹åºçš„ä¸€ç§è‡ªç„¶æ¨¡å¼ã€‚åŸºäºäº§å“çš„åº”ç”¨ç¨‹åºæ˜¯å·²ç»æ‰“åŒ…å¥½å¹¶ä¸”æ‹¥æœ‰ä¸åŒç‰ˆæœ¬ï¼Œå¯ä½œä¸ºç¬¬ä¸‰æ–¹æ’ä»¶ä¸‹è½½çš„ã€‚ç„¶åï¼Œå¾ˆå¤šå…¬å¸ä¹Ÿåœ¨å¼€å‘ã€å‘å¸ƒè‡ªå·±å†…éƒ¨å•†ä¸šåº”ç”¨åƒæœ‰ç‰ˆæœ¬å·ã€è¯´æ˜åŠå¯åŠ è½½æ’ä»¶å¼çš„åº”ç”¨è½¯ä»¶ï¼ˆè¿™ä¹Ÿæ˜¯è¿™ç§æ¨¡å¼çš„ç‰¹å¾ï¼‰ã€‚å¾®å†…æ ¸ç³»ç»Ÿå¯è®©ç”¨æˆ·æ·»åŠ é¢å¤–çš„åº”ç”¨å¦‚æ’ä»¶ï¼Œåˆ°æ ¸å¿ƒåº”ç”¨ï¼Œç»§è€Œæä¾›äº†å¯æ‰©å±•æ€§å’ŒåŠŸèƒ½åˆ†ç¦»çš„ç”¨æ³•ã€‚
> {: id="20210330211656-guyq9ly"}
{: id="20210330211656-sj70hkw"}

å¾®å†…æ ¸æ¶æ„åŒ…å«ä¸¤ç±»ç»„ä»¶ï¼š**æ ¸å¿ƒç³»ç»Ÿï¼ˆcore systemï¼‰** å’Œ **æ’ä»¶æ¨¡å—ï¼ˆplug-in modulesï¼‰**ã€‚
{: id="20210330211656-cruhnos"}

![](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/source-code/dubbo/%E5%BE%AE%E5%86%85%E6%A0%B8%E6%9E%B6%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE.png)
{: id="20210330211656-9b8lsev"}

æ ¸å¿ƒç³»ç»Ÿæä¾›ç³»ç»Ÿæ‰€éœ€æ ¸å¿ƒèƒ½åŠ›ï¼Œæ’ä»¶æ¨¡å—å¯ä»¥æ‰©å±•ç³»ç»Ÿçš„åŠŸèƒ½ã€‚å› æ­¤ï¼Œ åŸºäºå¾®å†…æ ¸æ¶æ„çš„ç³»ç»Ÿï¼Œéå¸¸æ˜“äºæ‰©å±•åŠŸèƒ½ã€‚
{: id="20210330211656-xstoikc"}

æˆ‘ä»¬å¸¸è§çš„ä¸€äº›IDEï¼Œéƒ½å¯ä»¥çœ‹ä½œæ˜¯åŸºäºå¾®å†…æ ¸æ¶æ„è®¾è®¡çš„ã€‚ç»å¤§å¤šæ•° IDEæ¯”å¦‚IDEAã€VSCodeéƒ½æä¾›äº†æ’ä»¶æ¥ä¸°å¯Œè‡ªå·±çš„åŠŸèƒ½ã€‚
{: id="20210330211656-37cwtve"}

æ­£æ˜¯å› ä¸ºDubboåŸºäºå¾®å†…æ ¸æ¶æ„ï¼Œæ‰ä½¿å¾—æˆ‘ä»¬å¯ä»¥éšå¿ƒæ‰€æ¬²æ›¿æ¢Dubboçš„åŠŸèƒ½ç‚¹ã€‚æ¯”å¦‚ä½ è§‰å¾—Dubbo çš„åºåˆ—åŒ–æ¨¡å—å®ç°çš„ä¸æ»¡è¶³è‡ªå·±è¦æ±‚ï¼Œæ²¡å…³ç³»å•Šï¼ä½ è‡ªå·±å®ç°ä¸€ä¸ªåºåˆ—åŒ–æ¨¡å—å°±å¥½äº†å•Šï¼
{: id="20210330211656-1mnqwkt"}

é€šå¸¸æƒ…å†µä¸‹ï¼Œå¾®æ ¸å¿ƒéƒ½ä¼šé‡‡ç”¨ Factoryã€IoCã€OSGi ç­‰æ–¹å¼ç®¡ç†æ’ä»¶ç”Ÿå‘½å‘¨æœŸã€‚Dubbo ä¸æƒ³ä¾èµ– Spring ç­‰ IoC å®¹å™¨ï¼Œä¹Ÿä¸æƒ³è‡ªå·²é€ ä¸€ä¸ªå°çš„ IoC å®¹å™¨ï¼ˆè¿‡åº¦è®¾è®¡ï¼‰ï¼Œå› æ­¤é‡‡ç”¨äº†ä¸€ç§æœ€ç®€å•çš„ Factory æ–¹å¼ç®¡ç†æ’ä»¶ ï¼š**JDK æ ‡å‡†çš„ SPI æ‰©å±•æœºåˆ¶** ï¼ˆ`java.util.ServiceLoader`ï¼‰ã€‚
{: id="20210330211656-whmeh2s"}

### å…³äºDubboæ¶æ„çš„ä¸€äº›è‡ªæµ‹å°é—®é¢˜
{: id="20210330211656-4y8e2ce"}

#### æ³¨å†Œä¸­å¿ƒçš„ä½œç”¨äº†è§£ä¹ˆï¼Ÿ
{: id="20210330211656-iczemdo"}

æ³¨å†Œä¸­å¿ƒè´Ÿè´£æœåŠ¡åœ°å€çš„æ³¨å†Œä¸æŸ¥æ‰¾ï¼Œç›¸å½“äºç›®å½•æœåŠ¡ï¼ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…åªåœ¨å¯åŠ¨æ—¶ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’ã€‚
{: id="20210330211656-4y85r4z"}

#### æœåŠ¡æä¾›è€…å®•æœºåï¼Œæ³¨å†Œä¸­å¿ƒä¼šåšä»€ä¹ˆï¼Ÿ
{: id="20210330211656-b05nk0j"}

æ³¨å†Œä¸­å¿ƒä¼šç«‹å³æ¨é€äº‹ä»¶é€šçŸ¥æ¶ˆè´¹è€…ã€‚
{: id="20210330211656-hm1vbbm"}

#### ç›‘æ§ä¸­å¿ƒçš„ä½œç”¨å‘¢ï¼Ÿ
{: id="20210330211656-oknycbp"}

ç›‘æ§ä¸­å¿ƒè´Ÿè´£ç»Ÿè®¡å„æœåŠ¡è°ƒç”¨æ¬¡æ•°ï¼Œè°ƒç”¨æ—¶é—´ç­‰ã€‚
{: id="20210330211656-wqupg63"}

#### æ³¨å†Œä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒéƒ½å®•æœºçš„è¯ï¼ŒæœåŠ¡éƒ½ä¼šæŒ‚æ‰å—ï¼Ÿ
{: id="20210330211656-28col08"}

ä¸ä¼šã€‚ä¸¤è€…éƒ½å®•æœºä¹Ÿä¸å½±å“å·²è¿è¡Œçš„æä¾›è€…å’Œæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…åœ¨æœ¬åœ°ç¼“å­˜äº†æä¾›è€…åˆ—è¡¨ã€‚æ³¨å†Œä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒéƒ½æ˜¯å¯é€‰çš„ï¼ŒæœåŠ¡æ¶ˆè´¹è€…å¯ä»¥ç›´è¿æœåŠ¡æä¾›è€…ã€‚
{: id="20210330211656-lzn1tlq"}

## Dubbo çš„è´Ÿè½½å‡è¡¡ç­–ç•¥
{: id="20210330211656-k79qaee"}

### ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ï¼Ÿ
{: id="20210330211656-bd4tjb8"}

å…ˆæ¥çœ‹ä¸€ä¸‹ç¨å¾®å®˜æ–¹ç‚¹çš„è§£é‡Šã€‚ä¸‹é¢è¿™æ®µè¯æ‘˜è‡ªç»´åŸºç™¾ç§‘å¯¹è´Ÿè½½å‡è¡¡çš„å®šä¹‰ï¼š
{: id="20210330211656-h5gvw41"}

> è´Ÿè½½å‡è¡¡æ”¹å–„äº†è·¨å¤šä¸ªè®¡ç®—èµ„æºï¼ˆä¾‹å¦‚è®¡ç®—æœºï¼Œè®¡ç®—æœºé›†ç¾¤ï¼Œç½‘ç»œé“¾æ¥ï¼Œä¸­å¤®å¤„ç†å•å…ƒæˆ–ç£ç›˜é©±åŠ¨ï¼‰çš„å·¥ä½œè´Ÿè½½åˆ†å¸ƒã€‚è´Ÿè½½å¹³è¡¡æ—¨åœ¨ä¼˜åŒ–èµ„æºä½¿ç”¨ï¼Œæœ€å¤§åŒ–ååé‡ï¼Œæœ€å°åŒ–å“åº”æ—¶é—´ï¼Œå¹¶é¿å…ä»»ä½•å•ä¸ªèµ„æºçš„è¿‡è½½ã€‚ä½¿ç”¨å…·æœ‰è´Ÿè½½å¹³è¡¡è€Œä¸æ˜¯å•ä¸ªç»„ä»¶çš„å¤šä¸ªç»„ä»¶å¯ä»¥é€šè¿‡å†—ä½™æé«˜å¯é æ€§å’Œå¯ç”¨æ€§ã€‚è´Ÿè½½å¹³è¡¡é€šå¸¸æ¶‰åŠä¸“ç”¨è½¯ä»¶æˆ–ç¡¬ä»¶ã€‚
> {: id="20210330211656-88nmqup"}
{: id="20210330211656-izncnrf"}

**ä¸Šé¢è®²çš„å¤§å®¶å¯èƒ½ä¸å¤ªå¥½ç†è§£ï¼Œå†ç”¨é€šä¿—çš„è¯ç»™å¤§å®¶è¯´ä¸€ä¸‹ã€‚**
{: id="20210330211656-ju4dkpe"}

æˆ‘ä»¬çš„ç³»ç»Ÿä¸­çš„æŸä¸ªæœåŠ¡çš„è®¿é—®é‡ç‰¹åˆ«å¤§ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªæœåŠ¡éƒ¨ç½²åœ¨äº†å¤šå°æœåŠ¡å™¨ä¸Šï¼Œå½“å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œå¤šå°æœåŠ¡å™¨éƒ½å¯ä»¥å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•æ­£ç¡®é€‰æ‹©å¤„ç†è¯¥è¯·æ±‚çš„æœåŠ¡å™¨å°±å¾ˆå…³é”®ã€‚å‡å¦‚ï¼Œä½ å°±è¦ä¸€å°æœåŠ¡å™¨æ¥å¤„ç†è¯¥æœåŠ¡çš„è¯·æ±‚ï¼Œé‚£è¯¥æœåŠ¡éƒ¨ç½²åœ¨å¤šå°æœåŠ¡å™¨çš„æ„ä¹‰å°±ä¸å¤å­˜åœ¨äº†ã€‚è´Ÿè½½å‡è¡¡å°±æ˜¯ä¸ºäº†é¿å…å•ä¸ªæœåŠ¡å™¨å“åº”åŒä¸€è¯·æ±‚ï¼Œå®¹æ˜“é€ æˆæœåŠ¡å™¨å®•æœºã€å´©æºƒç­‰é—®é¢˜ï¼Œæˆ‘ä»¬ä»è´Ÿè½½å‡è¡¡çš„è¿™å››ä¸ªå­—å°±èƒ½æ˜æ˜¾æ„Ÿå—åˆ°å®ƒçš„æ„ä¹‰ã€‚
{: id="20210330211656-kh1ghcb"}

### Dubbo æä¾›çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ
{: id="20210330211656-1zavn00"}

åœ¨é›†ç¾¤è´Ÿè½½å‡è¡¡æ—¶ï¼ŒDubbo æä¾›äº†å¤šç§å‡è¡¡ç­–ç•¥ï¼Œé»˜è®¤ä¸º `random` éšæœºè°ƒç”¨ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è‡ªè¡Œæ‰©å±•è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå‚è€ƒDubbo SPIæœºåˆ¶ï¼‰ã€‚
{: id="20210330211656-8zs83j5"}

åœ¨ Dubbo ä¸­ï¼Œæ‰€æœ‰è´Ÿè½½å‡è¡¡å®ç°ç±»å‡ç»§æ‰¿è‡ª `AbstractLoadBalance`ï¼Œè¯¥ç±»å®ç°äº† `LoadBalance` æ¥å£ï¼Œå¹¶å°è£…äº†ä¸€äº›å…¬å…±çš„é€»è¾‘ã€‚
{: id="20210330211656-rxn3wxa"}

```java
public abstract class AbstractLoadBalance implements LoadBalance {

    static int calculateWarmupWeight(int uptime, int warmup, int weight) {
    }

    @Override
    public <T> Invoker<T> select(List<Invoker<T>> invokers, URL url, Invocation invocation) {
    }

    protected abstract <T> Invoker<T> doSelect(List<Invoker<T>> invokers, URL url, Invocation invocation);


    int getWeight(Invoker<?> invoker, Invocation invocation) {

    }
}
```
{: id="20210330211656-apua1zq"}

`AbstractLoadBalance` çš„å®ç°ç±»æœ‰ä¸‹é¢è¿™äº›ï¼š
{: id="20210330211656-ft101rc"}

![](/Users/guide/Library/Application Support/typora-user-images/image-20210326105257812.png)
{: id="20210330211656-4fgngdz"}

å®˜æ–¹æ–‡æ¡£å¯¹è´Ÿè½½å‡è¡¡è¿™éƒ¨åˆ†çš„ä»‹ç»éå¸¸è¯¦ç»†ï¼Œæ¨èå°ä¼™ä¼´ä»¬çœ‹çœ‹ï¼Œåœ°å€ï¼š[https://dubbo.apache.org/zh/docs/v2.7/dev/source/loadbalance/#m-zhdocsv27devsourceloadbalance](https://dubbo.apache.org/zh/docs/v2.7/dev/source/loadbalance/#m-zhdocsv27devsourceloadbalance ) ã€‚
{: id="20210330211656-046bo4a"}

#### RandomLoadBalance
{: id="20210330211656-o71thv7"}

æ ¹æ®æƒé‡éšæœºé€‰æ‹©ï¼ˆå¯¹åŠ æƒéšæœºç®—æ³•çš„å®ç°ï¼‰ã€‚è¿™æ˜¯Dubboé»˜è®¤é‡‡ç”¨çš„ä¸€ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚
{: id="20210330211656-e69ebot"}

` RandomLoadBalance` å…·ä½“çš„å®ç°åŸç†éå¸¸ç®€å•ï¼Œå‡å¦‚æœ‰ä¸¤ä¸ªæä¾›ç›¸åŒæœåŠ¡çš„æœåŠ¡å™¨ S1,S2ï¼ŒS1çš„æƒé‡ä¸º7ï¼ŒS2çš„æƒé‡ä¸º3ã€‚
{: id="20210330211656-keha9zs"}

æˆ‘ä»¬æŠŠè¿™äº›æƒé‡å€¼åˆ†å¸ƒåœ¨åæ ‡åŒºé—´ä¼šå¾—åˆ°ï¼šS1->[0, 7) ï¼ŒS2->(7, 10]ã€‚æˆ‘ä»¬ç”Ÿæˆ[0, 10) ä¹‹é—´çš„éšæœºæ•°ï¼Œéšæœºæ•°è½åˆ°å¯¹åº”çš„åŒºé—´ï¼Œæˆ‘ä»¬å°±é€‰æ‹©å¯¹åº”çš„æœåŠ¡å™¨æ¥å¤„ç†è¯·æ±‚ã€‚
{: id="20210330211656-2827t9w"}

![RandomLoadBalance](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/java-guide-blog/%20RandomLoadBalance.png)
{: id="20210330211656-pta0a9v"}

`RandomLoadBalance` çš„æºç éå¸¸ç®€å•ï¼Œç®€å•èŠ±å‡ åˆ†é’Ÿæ—¶é—´çœ‹ä¸€ä¸‹ã€‚
{: id="20210330211656-uqgbzt2"}

> ä»¥ä¸‹æºç æ¥è‡ª Dubbo master åˆ†æ”¯ä¸Šçš„æœ€æ–°çš„ç‰ˆæœ¬ 2.7.9ã€‚
> {: id="20210330211656-vefk4nb"}
{: id="20210330211656-981iiye"}

```java
public class RandomLoadBalance extends AbstractLoadBalance {

    public static final String NAME = "random";

    @Override
    protected <T> Invoker<T> doSelect(List<Invoker<T>> invokers, URL url, Invocation invocation) {

        int length = invokers.size();
        boolean sameWeight = true;
        int[] weights = new int[length]; 
        int totalWeight = 0;
        // ä¸‹é¢è¿™ä¸ªforå¾ªç¯çš„ä¸»è¦ä½œç”¨å°±æ˜¯è®¡ç®—æ‰€æœ‰è¯¥æœåŠ¡çš„æä¾›è€…çš„æƒé‡ä¹‹å’Œ totalWeightï¼ˆï¼‰ï¼Œ
        // é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜ä¼šæ£€æµ‹æ¯ä¸ªæœåŠ¡æä¾›è€…çš„æƒé‡æ˜¯å¦ç›¸åŒ
        for (int i = 0; i < length; i++) {
            int weight = getWeight(invokers.get(i), invocation);
            totalWeight += weight;
            weights[i] = totalWeight;
            if (sameWeight && totalWeight != weight * (i + 1)) {
                sameWeight = false;
            }
        }
        if (totalWeight > 0 && !sameWeight) {
            // éšæœºç”Ÿæˆä¸€ä¸ª [0, totalWeight) åŒºé—´å†…çš„æ•°å­—
            int offset = ThreadLocalRandom.current().nextInt(totalWeight);
            // åˆ¤æ–­ä¼šè½åœ¨å“ªä¸ªæœåŠ¡æä¾›è€…çš„åŒºé—´
            for (int i = 0; i < length; i++) {
                if (offset < weights[i]) {
                    return invokers.get(i);
                }
            }
  
        return invokers.get(ThreadLocalRandom.current().nextInt(length));
    }

}

```
{: id="20210330211656-u0nwkfr"}

#### LeastActiveLoadBalance
{: id="20210330211656-8xzgawx"}

`LeastActiveLoadBalance` ç›´è¯‘è¿‡æ¥å°±æ˜¯**æœ€å°æ´»è·ƒæ•°è´Ÿè½½å‡è¡¡**ã€‚
{: id="20210330211656-6yw2c6z"}

è¿™ä¸ªåå­—èµ·å¾—æœ‰ç‚¹ä¸ç›´è§‚ï¼Œä¸ä»”ç»†çœ‹å®˜æ–¹å¯¹æ´»è·ƒæ•°çš„å®šä¹‰ï¼Œä½ å‹æ ¹ä¸çŸ¥é“è¿™ç©æ„æ˜¯å¹²å˜›çš„ã€‚
{: id="20210330211656-1iu8i1v"}

æˆ‘è¿™ä¹ˆè¯´å§ï¼åˆå§‹çŠ¶æ€ä¸‹æ‰€æœ‰æœåŠ¡æä¾›è€…çš„æ´»è·ƒæ•°å‡ä¸º 0ï¼ˆæ¯ä¸ªæœåŠ¡æä¾›è€…çš„ä¸­ç‰¹å®šæ–¹æ³•éƒ½å¯¹åº”ä¸€ä¸ªæ´»è·ƒæ•°ï¼Œæˆ‘åœ¨åé¢çš„æºç ä¸­ä¼šæåˆ°ï¼‰ï¼Œæ¯æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚åï¼Œå¯¹åº”çš„æœåŠ¡æä¾›è€…çš„æ´»è·ƒæ•° +1ï¼Œå½“è¿™ä¸ªè¯·æ±‚å¤„ç†å®Œä¹‹åï¼Œæ´»è·ƒæ•° -1ã€‚
{: id="20210330211656-rkwzz6z"}

å› æ­¤ï¼Œ**Dubbo å°±è®¤ä¸ºè°çš„æ´»è·ƒæ•°è¶Šå°‘ï¼Œè°çš„å¤„ç†é€Ÿåº¦å°±è¶Šå¿«ï¼Œæ€§èƒ½ä¹Ÿè¶Šå¥½ï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘å°±ä¼˜å…ˆæŠŠè¯·æ±‚ç»™æ´»è·ƒæ•°å°‘çš„æœåŠ¡æä¾›è€…å¤„ç†ã€‚**
{: id="20210330211656-4ld8p0k"}

**å¦‚æœæœ‰å¤šä¸ªæœåŠ¡æä¾›è€…çš„æ´»è·ƒæ•°ç›¸ç­‰æ€ä¹ˆåŠï¼Ÿ**
{: id="20210330211656-qig1u3e"}

å¾ˆç®€å•ï¼Œé‚£å°±å†èµ°ä¸€é  `RandomLoadBalance` ã€‚
{: id="20210330211656-8fw4dzm"}

```java
public class LeastActiveLoadBalance extends AbstractLoadBalance {

    public static final String NAME = "leastactive";

    @Override
    protected <T> Invoker<T> doSelect(List<Invoker<T>> invokers, URL url, Invocation invocation) {
        int length = invokers.size();
        int leastActive = -1;
        int leastCount = 0;
        int[] leastIndexes = new int[length];
        int[] weights = new int[length];
        int totalWeight = 0;
        int firstWeight = 0;
        boolean sameWeight = true;
        // è¿™ä¸ª for å¾ªç¯çš„ä¸»è¦ä½œç”¨æ˜¯éå† invokers åˆ—è¡¨ï¼Œæ‰¾å‡ºæ´»è·ƒæ•°æœ€å°çš„ Invoker
        // å¦‚æœæœ‰å¤šä¸ª Invoker å…·æœ‰ç›¸åŒçš„æœ€å°æ´»è·ƒæ•°ï¼Œè¿˜ä¼šè®°å½•ä¸‹è¿™äº› Invoker åœ¨ invokers é›†åˆä¸­çš„ä¸‹æ ‡ï¼Œå¹¶ç´¯åŠ å®ƒä»¬çš„æƒé‡ï¼Œæ¯”è¾ƒå®ƒä»¬çš„æƒé‡å€¼æ˜¯å¦ç›¸ç­‰
        for (int i = 0; i < length; i++) {
            Invoker<T> invoker = invokers.get(i);
            // è·å– invoker å¯¹åº”çš„æ´»è·ƒ(active)æ•°
            int active = RpcStatus.getStatus(invoker.getUrl(), invocation.getMethodName()).getActive();
            int afterWarmup = getWeight(invoker, invocation);
            weights[i] = afterWarmup;
            if (leastActive == -1 || active < leastActive) {
                leastActive = active;
                leastCount = 1;
                leastIndexes[0] = i;
                totalWeight = afterWarmup;
                firstWeight = afterWarmup;
                sameWeight = true;
            } else if (active == leastActive) {
                leastIndexes[leastCount++] = i;
                totalWeight += afterWarmup;
                if (sameWeight && afterWarmup != firstWeight) {
                    sameWeight = false;
                }
            }
        }
       // å¦‚æœåªæœ‰ä¸€ä¸ª Invoker å…·æœ‰æœ€å°çš„æ´»è·ƒæ•°ï¼Œæ­¤æ—¶ç›´æ¥è¿”å›è¯¥ Invoker å³å¯
        if (leastCount == 1) {
            return invokers.get(leastIndexes[0]);
        }
        // å¦‚æœæœ‰å¤šä¸ª Invoker å…·æœ‰ç›¸åŒçš„æœ€å°æ´»è·ƒæ•°ï¼Œä½†å®ƒä»¬ä¹‹é—´çš„æƒé‡ä¸åŒ
        // è¿™é‡Œçš„å¤„ç†æ–¹å¼å°±å’Œ  RandomLoadBalance ä¸€è‡´äº†
        if (!sameWeight && totalWeight > 0) {
            int offsetWeight = ThreadLocalRandom.current().nextInt(totalWeight);
            for (int i = 0; i < leastCount; i++) {
                int leastIndex = leastIndexes[i];
                offsetWeight -= weights[leastIndex];
                if (offsetWeight < 0) {
                    return invokers.get(leastIndex);
                }
            }
        }
        return invokers.get(leastIndexes[ThreadLocalRandom.current().nextInt(leastCount)]);
    }
}

```
{: id="20210330211656-laearzo"}

æ´»è·ƒæ•°æ˜¯é€šè¿‡ `RpcStatus` ä¸­çš„ä¸€ä¸ª `ConcurrentMap` ä¿å­˜çš„ï¼Œæ ¹æ® URL ä»¥åŠæœåŠ¡æä¾›è€…è¢«è°ƒç”¨çš„æ–¹æ³•çš„åç§°ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥è·å–åˆ°å¯¹åº”çš„æ´»è·ƒæ•°ã€‚ä¹Ÿå°±æ˜¯è¯´æœåŠ¡æä¾›è€…ä¸­çš„æ¯ä¸€ä¸ªæ–¹æ³•çš„æ´»è·ƒæ•°éƒ½æ˜¯äº’ç›¸ç‹¬ç«‹çš„ã€‚
{: id="20210330211656-aqyqept"}

```java
public class RpcStatus {
    
    private static final ConcurrentMap<String, ConcurrentMap<String, RpcStatus>> METHOD_STATISTICS =
            new ConcurrentHashMap<String, ConcurrentMap<String, RpcStatus>>();

   public static RpcStatus getStatus(URL url, String methodName) {
        String uri = url.toIdentityString();
        ConcurrentMap<String, RpcStatus> map = METHOD_STATISTICS.computeIfAbsent(uri, k -> new ConcurrentHashMap<>());
        return map.computeIfAbsent(methodName, k -> new RpcStatus());
    }
    public int getActive() {
        return active.get();
    }

}
```
{: id="20210330211656-fbxvty9"}

#### ConsistentHashLoadBalance
{: id="20210330211656-8vxpy0e"}

`ConsistentHashLoadBalance`  å°ä¼™ä¼´ä»¬åº”è¯¥ä¹Ÿä¸ä¼šé™Œç”Ÿï¼Œåœ¨åˆ†åº“åˆ†è¡¨ã€å„ç§é›†ç¾¤ä¸­å°±ç»å¸¸ä½¿ç”¨è¿™ä¸ªè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚
{: id="20210330211656-op1kq2p"}

`ConsistentHashLoadBalance` å³**ä¸€è‡´æ€§Hashè´Ÿè½½å‡è¡¡ç­–ç•¥**ã€‚ `ConsistentHashLoadBalance` ä¸­æ²¡æœ‰æƒé‡çš„æ¦‚å¿µï¼Œå…·ä½“æ˜¯å“ªä¸ªæœåŠ¡æä¾›è€…å¤„ç†è¯·æ±‚æ˜¯ç”±ä½ çš„è¯·æ±‚çš„å‚æ•°å†³å®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€ä¸ªæœåŠ¡æä¾›è€…ã€‚
{: id="20210330211656-zetkahe"}

![](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/java-guide-blog/consistent-hash-data-incline.jpg)
{: id="20210330211656-pxjrsor"}

å¦å¤–ï¼ŒDubbo ä¸ºäº†é¿å…æ•°æ®å€¾æ–œé—®é¢˜ï¼ˆèŠ‚ç‚¹ä¸å¤Ÿåˆ†æ•£ï¼Œå¤§é‡è¯·æ±‚è½åˆ°åŒä¸€èŠ‚ç‚¹ï¼‰ï¼Œè¿˜å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹çš„æ¦‚å¿µã€‚é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹å¯ä»¥è®©èŠ‚ç‚¹æ›´åŠ åˆ†æ•£ï¼Œæœ‰æ•ˆå‡è¡¡å„ä¸ªèŠ‚ç‚¹çš„è¯·æ±‚é‡ã€‚
{: id="20210330211656-bm4lt9p"}

![](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/java-guide-blog/consistent-hash-invoker.jpg)
{: id="20210330211656-cpxotph"}

å®˜æ–¹æœ‰è¯¦ç»†çš„æºç åˆ†æï¼š[https://dubbo.apache.org/zh/docs/v2.7/dev/source/loadbalance/#23-consistenthashloadbalance](https://dubbo.apache.org/zh/docs/v2.7/dev/source/loadbalance/#23-consistenthashloadbalance) ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç›¸å…³çš„ [PR#5440](https://github.com/apache/dubbo/pull/5440) æ¥ä¿®å¤è€ç‰ˆæœ¬ä¸­ ConsistentHashLoadBalance å­˜åœ¨çš„ä¸€äº›Bugã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥å¤šèŠ±ç‚¹æ—¶é—´ç ”ç©¶ä¸€ä¸‹ã€‚æˆ‘è¿™é‡Œä¸å¤šåˆ†æäº†ï¼Œè¿™ä¸ªä½œä¸šç•™ç»™ä½ ä»¬ï¼
{: id="20210330211656-f5lh374"}

#### RoundRobinLoadBalance
{: id="20210330211656-otsxhc7"}

åŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡ã€‚
{: id="20210330211656-77pwrx6"}

è½®è¯¢å°±æ˜¯æŠŠè¯·æ±‚ä¾æ¬¡åˆ†é…ç»™æ¯ä¸ªæœåŠ¡æä¾›è€…ã€‚åŠ æƒè½®è¯¢å°±æ˜¯åœ¨è½®è¯¢çš„åŸºç¡€ä¸Šï¼Œè®©æ›´å¤šçš„è¯·æ±‚è½åˆ°æƒé‡æ›´å¤§çš„æœåŠ¡æä¾›è€…ä¸Šã€‚æ¯”å¦‚å‡å¦‚æœ‰ä¸¤ä¸ªæä¾›ç›¸åŒæœåŠ¡çš„æœåŠ¡å™¨ S1,S2ï¼ŒS1çš„æƒé‡ä¸º7ï¼ŒS2çš„æƒé‡ä¸º3ã€‚
{: id="20210330211656-ac9hopc"}

å¦‚æœæˆ‘ä»¬æœ‰ 10 æ¬¡è¯·æ±‚ï¼Œé‚£ä¹ˆ  7 æ¬¡ä¼šè¢« S1å¤„ç†ï¼Œ3æ¬¡è¢« S2å¤„ç†ã€‚
{: id="20210330211656-lqhrhae"}

ä½†æ˜¯ï¼Œå¦‚æœæ˜¯ `RandomLoadBalance` çš„è¯ï¼Œå¾ˆå¯èƒ½å­˜åœ¨10æ¬¡è¯·æ±‚æœ‰9æ¬¡éƒ½è¢« S1 å¤„ç†çš„æƒ…å†µï¼ˆæ¦‚ç‡æ€§é—®é¢˜ï¼‰ã€‚
{: id="20210330211656-e129dpa"}

Dubbo ä¸­çš„ `RoundRobinLoadBalance` çš„ä»£ç å®ç°è¢«ä¿®æ”¹é‡å»ºäº†å¥½å‡ æ¬¡ï¼ŒDubbo-2.6.5 ç‰ˆæœ¬çš„ `RoundRobinLoadBalance` ä¸ºå¹³æ»‘åŠ æƒè½®è¯¢ç®—æ³•ã€‚
{: id="20210330211656-8qvt8z9"}

## Dubboåºåˆ—åŒ–åè®®
{: id="20210330211656-9ifk0hv"}

### Dubbo æ”¯æŒå“ªäº›åºåˆ—åŒ–æ–¹å¼å‘¢ï¼Ÿ
{: id="20210330211656-b0eftua"}

![](https://img-blog.csdnimg.cn/20210328092219640.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0MzM3Mjcy,size_16,color_FFFFFF,t_70)
{: id="20210330211656-xx99lxo"}

Dubbo æ”¯æŒå¤šç§åºåˆ—åŒ–æ–¹å¼ï¼šJDKè‡ªå¸¦çš„åºåˆ—åŒ–ã€hessian2ã€JSONã€Kryoã€FSTã€Protostuffï¼ŒProtoBufç­‰ç­‰ã€‚
{: id="20210330211656-ssg9og1"}

Dubbo é»˜è®¤ä½¿ç”¨çš„åºåˆ—åŒ–æ–¹å¼æ˜¯ hession2ã€‚
{: id="20210330211656-8z6leno"}

### è°ˆè°ˆä½ å¯¹è¿™äº›åºåˆ—åŒ–åè®®äº†è§£ï¼Ÿ
{: id="20210330211656-bk7ow2a"}

ä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šç›´æ¥ä½¿ç”¨ JDK è‡ªå¸¦çš„åºåˆ—åŒ–æ–¹å¼ã€‚ä¸»è¦åŸå› æœ‰ä¸¤ä¸ªï¼š
{: id="20210330211656-oo2dc11"}

1. {: id="20210330211656-y6axkim"}**ä¸æ”¯æŒè·¨è¯­è¨€è°ƒç”¨** : å¦‚æœè°ƒç”¨çš„æ˜¯å…¶ä»–è¯­è¨€å¼€å‘çš„æœåŠ¡çš„æ—¶å€™å°±ä¸æ”¯æŒäº†ã€‚
   {: id="20210330211656-kdtrqmk"}
2. {: id="20210330211656-oc8yh87"}**æ€§èƒ½å·®** ï¼šç›¸æ¯”äºå…¶ä»–åºåˆ—åŒ–æ¡†æ¶æ€§èƒ½æ›´ä½ï¼Œä¸»è¦åŸå› æ˜¯åºåˆ—åŒ–ä¹‹åçš„å­—èŠ‚æ•°ç»„ä½“ç§¯è¾ƒå¤§ï¼Œå¯¼è‡´ä¼ è¾“æˆæœ¬åŠ å¤§ã€‚
   {: id="20210330211656-ehjdn3x"}
{: id="20210330211656-aa94z5r"}

JSON åºåˆ—åŒ–ç”±äºæ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¹Ÿä¸ä¼šè€ƒè™‘ä½¿ç”¨ã€‚
{: id="20210330211656-mlfbmnj"}

åƒ Protostuffï¼ŒProtoBufã€hessian2è¿™äº›éƒ½æ˜¯è·¨è¯­è¨€çš„åºåˆ—åŒ–æ–¹å¼ï¼Œå¦‚æœæœ‰è·¨è¯­è¨€éœ€æ±‚çš„è¯å¯ä»¥è€ƒè™‘ä½¿ç”¨ã€‚
{: id="20210330211656-3vfqixq"}

Kryoå’ŒFSTè¿™ä¸¤ç§åºåˆ—åŒ–æ–¹å¼æ˜¯ Dubbo åæ¥æ‰å¼•å…¥çš„ï¼Œæ€§èƒ½éå¸¸å¥½ã€‚ä¸è¿‡ï¼Œè¿™ä¸¤è€…éƒ½æ˜¯ä¸“é—¨é’ˆå¯¹ Java è¯­è¨€çš„ã€‚Dubbo å®˜ç½‘çš„ä¸€ç¯‡æ–‡ç« ä¸­æåˆ°è¯´æ¨èä½¿ç”¨ Kryo ä½œä¸ºç”Ÿäº§ç¯å¢ƒçš„åºåˆ—åŒ–æ–¹å¼ã€‚(æ–‡ç« åœ°å€ï¼š[https://dubbo.apache.org/zh/docs/v2.7/user/references/protocol/rest/](https://dubbo.apache.org/zh/docs/v2.7/user/references/protocol/rest/))
{: id="20210330211656-c48n4op"}

![](https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2020-8/569e541a-22b2-4846-aa07-0ad479f07440.png)
{: id="20210330211656-gr9jdhb"}

Dubbo å®˜æ–¹æ–‡æ¡£ä¸­è¿˜æœ‰ä¸€ä¸ªå…³äºè¿™äº›[åºåˆ—åŒ–åè®®çš„æ€§èƒ½å¯¹æ¯”å›¾](https://dubbo.apache.org/zh/docs/v2.7/user/serialization/#m-zhdocsv27userserialization)å¯ä¾›å‚è€ƒã€‚
{: id="20210330211656-4qa069h"}

![](https://img-blog.csdnimg.cn/20210328093219609.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0MzM3Mjcy,size_16,color_FFFFFF,t_70)
{: id="20210330211656-a4n3fx6"}


{: id="20210330211656-fvhpuo9" type="doc"}
